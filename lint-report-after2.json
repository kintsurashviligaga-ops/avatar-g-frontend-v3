[{"filePath":"C:\\Users\\admin\\OneDrive\\Desktop\\avatar-g-frontend-v3\\app\\[locale]\\account\\billing\\page.tsx","messages":[{"ruleId":null,"fatal":true,"severity":2,"message":"Parsing error: JSX element 'div' has no corresponding closing tag.","line":78,"column":7,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { useTranslations } from 'next-intl';\r\nimport { Calendar, ArrowUpRight, CreditCard, Download } from 'lucide-react';\r\nimport { Card } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { useSubscriptionStatus } from '@/hooks/useSubscriptionStatus';\r\n\r\nexport default function AccountBillingPage() {\r\n  const t = useTranslations('billing');\r\n  const subscriptionT = useTranslations('subscription');\r\n  const { data, loading, error, openCustomerPortal } = useSubscriptionStatus();\r\n  const [actionError, setActionError] = useState<string | null>(null);\r\n  const [financeData, setFinanceData] = useState<any>(null);\r\n  const [financeLoading, setFinanceLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (data?.hasSubscription) {\r\n      fetchFinanceData();\r\n    }\r\n  }, [data?.hasSubscription]);\r\n\r\n  const fetchFinanceData = async () => {\r\n    try {\r\n      setFinanceLoading(true);\r\n      const res = await fetch('/api/finance/me/summary', { method: 'GET' });\r\n      if (res.ok) {\r\n        const financeJson = await res.json();\r\n        setFinanceData(financeJson);\r\n      }\r\n    } catch (err) {\r\n      console.error('Error fetching finance data:', err);\r\n    } finally {\r\n      setFinanceLoading(false);\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateString: string | null) => {\r\n    if (!dateString) return t('summary.no_date');\r\n    return new Date(dateString).toLocaleDateString('ka-GE', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n    });\r\n  };\r\n\r\n  const formatCurrency = (cents: number) => {\r\n    return `$${(cents / 100).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\r\n  };\r\n\r\n  const resolveStatusLabel = (status: string | null) => {\r\n    if (!status) return t('status.none');\r\n    return subscriptionT(`status.${status}` as any);\r\n  };\r\n\r\n  const planLabel = data?.subscription?.plan\r\n    ? subscriptionT(`plans.${data.subscription.plan}.title` as any)\r\n    : t('summary.no_plan');\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-[#05070A] via-[#0A0F1C] to-[#05070A] py-16 px-4\">\r\n        <div className=\"max-w-4xl mx-auto\">\r\n          <div className=\"animate-pulse space-y-6\">\r\n            <div className=\"h-8 w-48 bg-white/10 rounded\" />\r\n            <div className=\"h-4 w-64 bg-white/5 rounded\" />\r\n            <div className=\"h-48 bg-white/5 rounded-xl\" />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-[#05070A] via-[#0A0F1C] to-[#05070A] py-16 px-4\">\r\n      <div className=\"max-w-4xl mx-auto space-y-8\">\r\n        <div>\r\n          <h1 className=\"text-4xl font-bold text-white mb-3\">{t('title')}</h1>\r\n          <p className=\"text-gray-400\">{t('subtitle')}</p>\r\n        </div>\r\n\r\n        {(error || actionError) && (\r\n          <Card className=\"bg-red-500/10 border-red-500/30 p-4 text-red-300\">\r\n            {actionError || t('errors.loadFailed')}\r\n          </Card>\r\n        )}\r\n\r\n        {!data?.hasSubscription && (\r\n          <Card className=\"bg-black/40 border-white/10 p-6 space-y-4\">\r\n            <div className=\"flex items-start gap-4\">\r\n              <div className=\"w-10 h-10 rounded-full bg-cyan-500/20 flex items-center justify-center\">\r\n                <CreditCard className=\"w-5 h-5 text-cyan-300\" />\r\n              </div>\r\n              <div>\r\n                <h2 className=\"text-xl font-semibold text-white\">{t('empty.title')}</h2>\r\n                <p className=\"text-gray-400 mt-2\">{t('empty.description')}</p>\r\n              </div>\r\n            </div>\r\n            <Link href=\"/pricing\" className=\"inline-flex\">\r\n              <Button className=\"bg-gradient-to-r from-cyan-500 to-blue-600 text-white\">\r\n                {t('empty.cta')}\r\n              </Button>\r\n            </Link>\r\n          </Card>\r\n        )}\r\n\r\n        {data?.hasSubscription && (\r\n          <Card className=\"bg-black/40 border-white/10 p-6 space-y-6\">\r\n            <div className=\"flex items-start justify-between gap-6\">\r\n              <div>\r\n                <p className=\"text-sm text-gray-400\">{t('summary.plan')}</p>\r\n                <h2 className=\"text-2xl font-semibold text-white\">{planLabel}</h2>\r\n              </div>\r\n              <div className=\"text-right\">\r\n                <p className=\"text-sm text-gray-400\">{t('summary.status')}</p>\r\n                <span className=\"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-emerald-500/20 text-emerald-300 border border-emerald-500/30\">\r\n                  {resolveStatusLabel(data.status)}\r\n                </span>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"grid md:grid-cols-2 gap-6\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"w-10 h-10 rounded-full bg-white/5 flex items-center justify-center\">\r\n                  <Calendar className=\"w-5 h-5 text-gray-300\" />\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-sm text-gray-400\">{t('summary.nextBilling')}</p>\r\n                  <p className=\"text-white font-medium\">\r\n                    {formatDate(data.currentPeriodEnd)}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"w-10 h-10 rounded-full bg-white/5 flex items-center justify-center\">\r\n                  <ArrowUpRight className=\"w-5 h-5 text-gray-300\" />\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-sm text-gray-400\">{t('summary.cancelAtPeriodEnd')}</p>\r\n                  <p className=\"text-white font-medium\">\r\n                    {data.cancelAtPeriodEnd ? t('summary.cancelYes') : t('summary.cancelNo')}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex flex-wrap gap-3\">\r\n              <Button\r\n                onClick={async () => {\r\n                  try {\r\n                    setActionError(null);\r\n                    await openCustomerPortal();\r\n                  } catch (err) {\r\n                    setActionError(err instanceof Error ? err.message : t('errors.loadFailed'));\r\n                  }\r\n                }}\r\n                className=\"bg-gradient-to-r from-cyan-500 to-blue-600 text-white\"\r\n              >\r\n                {t('actions.manageBilling')}\r\n              </Button>\r\n              <Link href=\"/pricing\">\r\n                <Button variant=\"outline\" className=\"border-white/20 text-white hover:bg-white/10\">\r\n                  {t('actions.changePlan')}\r\n                </Button>\r\n              </Link>\r\n            </div>\r\n          </Card>\r\n        )}\r\n\r\n        {data?.hasSubscription && financeData && (\r\n          <Card className=\"bg-black/40 border-white/10 p-6 space-y-6\">\r\n            <div>\r\n              <h2 className=\"text-2xl font-semibold text-white\">{t('history.title') || 'Payment History'}</h2>\r\n              <p className=\"text-gray-400 mt-1\">{t('history.subtitle') || 'Your recent invoices and transactions'}</p>\r\n            </div>\r\n\r\n            {/* Total Paid Summary */}\r\n            <div className=\"grid md:grid-cols-3 gap-4\">\r\n              <div className=\"bg-white/5 rounded-lg p-4\">\r\n                <p className=\"text-sm text-gray-400\">{t('history.totalPaid') || 'Total Paid'}</p>\r\n                <p className=\"text-2xl font-bold text-white mt-2\">{formatCurrency(financeData.totals?.totalPaid || 0)}</p>\r\n              </div>\r\n              <div className=\"bg-white/5 rounded-lg p-4\">\r\n                <p className=\"text-sm text-gray-400\">{t('history.invoices') || 'Invoices'}</p>\r\n                <p className=\"text-2xl font-bold text-white mt-2\">{financeData.totals?.invoiceCount || 0}</p>\r\n              </div>\r\n              <div className=\"bg-white/5 rounded-lg p-4\">\r\n                <p className=\"text-sm text-gray-400\">{t('history.payments') || 'Transactions'}</p>\r\n                <p className=\"text-2xl font-bold text-white mt-2\">{financeData.totals?.paymentCount || 0}</p>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Recent Invoices */}\r\n            {financeData.recentInvoices && financeData.recentInvoices.length > 0 && (\r\n              <div>\r\n                <h3 className=\"text-lg font-semibold text-white mb-3\">{t('history.invoices') || 'Recent Invoices'}</h3>\r\n                <div className=\"overflow-x-auto\">\r\n                  <table className=\"w-full text-sm\">\r\n                    <thead className=\"border-b border-white/10\">\r\n                      <tr>\r\n                        <th className=\"text-left py-2 px-3 text-gray-400 font-medium\">{t('history.date') || 'Date'}</th>\r\n                        <th className=\"text-left py-2 px-3 text-gray-400 font-medium\">{t('history.invoice') || 'Invoice'}</th>\r\n                        <th className=\"text-left py-2 px-3 text-gray-400 font-medium\">{t('history.amount') || 'Amount'}</th>\r\n                        <th className=\"text-left py-2 px-3 text-gray-400 font-medium\">{t('history.status') || 'Status'}</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                      {financeData.recentInvoices.map((inv: any) => (\r\n                        <tr key={inv.id} className=\"border-b border-white/5 hover:bg-white/5 transition\">\r\n                          <td className=\"py-3 px-3 text-white\">{formatDate(inv.created_at)}</td>\r\n                          <td className=\"py-3 px-3 text-gray-300 font-mono text-xs\">{inv.stripe_invoice_id?.slice(0, 12)}</td>\r\n                          <td className=\"py-3 px-3 text-white font-medium\">{formatCurrency(inv.amount_cents || 0)}</td>\r\n                          <td className=\"py-3 px-3\">\r\n                            <span className={`px-2 py-1 rounded text-xs font-semibold ${\r\n                              inv.status === 'paid' ? 'bg-emerald-500/20 text-emerald-300' : 'bg-gray-500/20 text-gray-300'\r\n                            }`}>\r\n                              {inv.status}\r\n                            </span>\r\n                          </td>\r\n                        </tr>\r\n                      ))}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Recent Payments */}\r\n            {financeData.recentPayments && financeData.recentPayments.length > 0 && (\r\n              <div>\r\n                <h3 className=\"text-lg font-semibold text-white mb-3\">{t('history.payments') || 'Recent Transactions'}</h3>\r\n                <div className=\"overflow-x-auto\">\r\n                  <table className=\"w-full text-sm\">\r\n                    <thead className=\"border-b border-white/10\">\r\n                      <tr>\r\n                        <th className=\"text-left py-2 px-3 text-gray-400 font-medium\">{t('history.date') || 'Date'}</th>\r\n                        <th className=\"text-left py-2 px-3 text-gray-400 font-medium\">{t('history.description') || 'Description'}</th>\r\n                        <th className=\"text-left py-2 px-3 text-gray-400 font-medium\">{t('history.amount') || 'Amount'}</th>\r\n                        <th className=\"text-left py-2 px-3 text-gray-400 font-medium\">{t('history.status') || 'Status'}</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                      {financeData.recentPayments.map((payment: any) => (\r\n                        <tr key={payment.id} className=\"border-b border-white/5 hover:bg-white/5 transition\">\r\n                          <td className=\"py-3 px-3 text-white\">{formatDate(payment.created_at)}</td>\r\n                          <td className=\"py-3 px-3 text-gray-300\">{payment.description || 'Payment'}</td>\r\n                          <td className=\"py-3 px-3 text-white font-medium\">{formatCurrency(payment.amount_cents || 0)}</td>\r\n                          <td className=\"py-3 px-3\">\r\n                            <span className={`px-2 py-1 rounded text-xs font-semibold ${\r\n                              payment.status === 'succeeded' ? 'bg-emerald-500/20 text-emerald-300' : 'bg-yellow-500/20 text-yellow-300'\r\n                            }`}>\r\n                              {payment.status}\r\n                            </span>\r\n                          </td>\r\n                        </tr>\r\n                      ))}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </Card>\r\n        )}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\admin\\OneDrive\\Desktop\\avatar-g-frontend-v3\\app\\[locale]\\dashboard\\fulfillment\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchJobs'. Either include it or remove the dependency array.","line":36,"column":6,"nodeType":"ArrayExpression","endLine":36,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchJobs, filter]","fix":{"range":[912,920],"text":"[fetchJobs, filter]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useTranslations } from 'next-intl';\r\nimport { motion } from 'framer-motion';\r\nimport { Package, AlertCircle, CheckCircle, Clock, TruckIcon } from 'lucide-react';\r\n\r\ninterface FulfillmentJob {\r\n  id: string;\r\n  order_id: string;\r\n  fulfillment_type: string;\r\n  status: string;\r\n  tracking_number?: string;\r\n  carrier?: string;\r\n  error_message?: string;\r\n  retry_count: number;\r\n  created_at: string;\r\n  orders?: {\r\n    order_number: string;\r\n    buyer_name: string;\r\n    total_amount: number;\r\n  };\r\n  suppliers?: {\r\n    name: string;\r\n  };\r\n}\r\n\r\nexport default function FulfillmentDashboard() {\r\n  const _t = useTranslations();\r\n  const [jobs, setJobs] = useState<FulfillmentJob[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [filter, setFilter] = useState<string>('all');\r\n\r\n  useEffect(() => {\r\n    fetchJobs();\r\n  }, [filter]);\r\n\r\n  const fetchJobs = async () => {\r\n    try {\r\n      const url = filter === 'all' ? '/api/fulfillment' : `/api/fulfillment?status=${filter}`;\r\n      const response = await fetch(url);\r\n      const data = await response.json();\r\n      setJobs(data.jobs || []);\r\n    } catch (error) {\r\n      console.error('Error fetching jobs:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleRetry = async (jobId: string) => {\r\n    try {\r\n      await fetch(`/api/fulfillment/${jobId}/retry`, { method: 'POST' });\r\n      fetchJobs();\r\n    } catch (error) {\r\n      console.error('Error retrying job:', error);\r\n    }\r\n  };\r\n\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status) {\r\n      case'queued':\r\n        return <Clock className=\"w-5 h-5 text-yellow-500\" />;\r\n      case 'processing':\r\n        return <Package className=\"w-5 h-5 text-blue-500\" />;\r\n      case 'shipped':\r\n        return <TruckIcon className=\"w-5 h-5 text-green-500\" />;\r\n      case 'delivered':\r\n        return <CheckCircle className=\"w-5 h-5 text-green-600\" />;\r\n      case 'failed':\r\n        return <AlertCircle className=\"w-5 h-5 text-red-500\" />;\r\n      default:\r\n        return <Package className=\"w-5 h-5 text-gray-500\" />;\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-[#05070A] via-[#0A0F1C] to-[#05070A] flex items-center justify-center\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-[#05070A] via-[#0A0F1C] to-[#05070A] py-16 px-4\">\r\n      <div className=\"max-w-7xl mx-auto\">\r\n        <h1 className=\"text-4xl font-bold text-white mb-8\">Fulfillment Dashboard</h1>\r\n\r\n        {/* Status Filter */}\r\n        <div className=\"flex gap-2 mb-6 overflow-x-auto\">\r\n          {['all', 'queued', 'processing', 'shipped', 'delivered', 'failed'].map((status) => (\r\n            <button\r\n              key={status}\r\n              onClick={() => setFilter(status)}\r\n              className={`px-4 py-2 rounded-full text-sm font-medium whitepsace-nowrap ${\r\n                filter === status\r\n                  ? 'bg-blue-500 text-white'\r\n                  : 'bg-white/5 text-gray-400 hover:bg-white/10'\r\n              }`}\r\n            >\r\n              {status.charAt(0).toUpperCase() + status.slice(1)}\r\n            </button>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Jobs List */}\r\n        <div className=\"space-y-4\">\r\n          {jobs.length === 0 ? (\r\n            <div className=\"bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl p-12 text-center\">\r\n              <Package className=\"w-16 h-16 text-gray-500 mx-auto mb-4\" />\r\n              <h3 className=\"text-xl font-semibold text-white mb-2\">No fulfillment jobs</h3>\r\n              <p className=\"text-gray-400\">No jobs found with this filter</p>\r\n            </div>\r\n          ) : (\r\n            jobs.map((job) => (\r\n              <motion.div\r\n                key={job.id}\r\n                initial={{ opacity: 0, y: 20 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                className=\"bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl p-6\"\r\n              >\r\n                <div className=\"flex items-start justify-between mb-4\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    {getStatusIcon(job.status)}\r\n                    <div>\r\n                      <h3 className=\"text-lg font-semibold text-white\">\r\n                        Order #{job.orders?.order_number}\r\n                      </h3>\r\n                      <p className=\"text-sm text-gray-400\">\r\n                        {job.fulfillment_type} â€¢ {job.suppliers?.name || 'Manual'}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                  <span\r\n                    className={`px-4 py-2 rounded-full text-sm font-medium ${\r\n                      job.status === 'delivered'\r\n                        ? 'bg-green-500/10 text-green-500'\r\n                        : job.status === 'failed'\r\n                        ? 'bg-red-500/10 text-red-500'\r\n                        : job.status === 'shipped'\r\n                        ? 'bg-blue-500/10 text-blue-500'\r\n                        : 'bg-yellow-500/10 text-yellow-500'\r\n                    }`}\r\n                  >\r\n                    {job.status}\r\n                  </span>\r\n                </div>\r\n\r\n                {job.tracking_number && (\r\n                  <div className=\"mb-4 p-3 bg-white/5 rounded-lg\">\r\n                    <p className=\"text-sm text-gray-400\">Tracking</p>\r\n                    <p className=\"text-white font-mono\">{job.tracking_number}</p>\r\n                    <p className=\"text-sm text-gray-400\">{job.carrier}</p>\r\n                  </div>\r\n                )}\r\n\r\n                {job.error_message && (\r\n                  <div className=\"mb-4 p-3 bg-red-500/10 rounded-lg\">\r\n                    <p className=\"text-sm text-red-400\">Error</p>\r\n                    <p className=\"text-white text-sm\">{job.error_message}</p>\r\n                    <p className=\"text-sm text-gray-400 mt-1\">\r\n                      Retry attempts: {job.retry_count}\r\n                    </p>\r\n                  </div>\r\n                )}\r\n\r\n                {job.status === 'failed' && (\r\n                  <button\r\n                    onClick={() => handleRetry(job.id)}\r\n                    className=\"w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors\"\r\n                  >\r\n                    Retry Fulfillment\r\n                  </button>\r\n                )}\r\n              </motion.div>\r\n            ))\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\admin\\OneDrive\\Desktop\\avatar-g-frontend-v3\\app\\[locale]\\tracking\\[orderId]\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTracking'. Either include it or remove the dependency array.","line":37,"column":6,"nodeType":"ArrayExpression","endLine":37,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTracking, orderId]","fix":{"range":[943,952],"text":"[fetchTracking, orderId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useParams } from 'next/navigation';\r\nimport { motion } from 'framer-motion';\r\nimport { Package, TruckIcon, CheckCircle, MapPin } from 'lucide-react';\r\n\r\ninterface ShipmentEvent {\r\n  timestamp: string;\r\n  status: string;\r\n  location?: string;\r\n  description: string;\r\n}\r\n\r\ninterface Shipment {\r\n  id: string;\r\n  tracking_number: string;\r\n  carrier: string;\r\n  status: string;\r\n  shipped_at?: string;\r\n  estimated_delivery_at?: string;\r\n  delivered_at?: string;\r\n  tracking_events: ShipmentEvent[];\r\n}\r\n\r\nexport default function OrderTrackingPage() {\r\n  const params = useParams();\r\n  const orderId = params.orderId as string;\r\n  const [order, setOrder] = useState<unknown>(null);\r\n  const [shipments, setShipments] = useState<Shipment[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (orderId) {\r\n      fetchTracking();\r\n    }\r\n  }, [orderId]);\r\n\r\n  const fetchTracking = async () => {\r\n    try {\r\n      const response = await fetch(`/api/tracking/${orderId}`);\r\n      const data = await response.json();\r\n      setOrder(data.order);\r\n      setShipments(data.shipments || []);\r\n    } catch (error) {\r\n      console.error('Error fetching tracking:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-[#05070A] via-[#0A0F1C] to-[#05070A] flex items-center justify-center\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!order) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-[#05070A] via-[#0A0F1C] to-[#05070A] flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <Package className=\"w-16 h-16 text-gray-500 mx-auto mb-4\" />\r\n          <h2 className=\"text-2xl font-bold text-white mb-2\">Order Not Found</h2>\r\n          <p className=\"text-gray-400\">Unable to find tracking information for this order</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-[#05070A] via-[#0A0F1C] to-[#05070A] py-16 px-4\">\r\n      <div className=\"max-w-4xl mx-auto\">\r\n        {/* Order Header */}\r\n        <motion.div\r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          className=\"bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl p-8 mb-8\"\r\n        >\r\n          <h1 className=\"text-3xl font-bold text-white mb-2\">\r\n            Order #{order.orderNumber}\r\n          </h1>\r\n          <p className=\"text-gray-400\">\r\n            Placed on {new Date(order.createdAt).toLocaleDateString()}\r\n          </p>\r\n          <div className=\"mt-4 inline-block px-4 py-2 bg-blue-500/10 text-blue-500 rounded-full text-sm font-medium\">\r\n            {order.status}\r\n          </div>\r\n        </motion.div>\r\n\r\n        {/* Shipments */}\r\n        {shipments.length === 0 ? (\r\n          <motion.div\r\n            initial={{ opacity: 0, y: 20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl p-12 text-center\"\r\n          >\r\n            <TruckIcon className=\"w-16 h-16 text-gray-500 mx-auto mb-4\" />\r\n            <h3 className=\"text-xl font-semibold text-white mb-2\">Preparing Shipment</h3>\r\n            <p className=\"text-gray-400\">\r\n              Your order is being prepared. Tracking information will appear here once shipped.\r\n            </p>\r\n          </motion.div>\r\n        ) : (\r\n          shipments.map((shipment, index) => (\r\n            <motion.div\r\n              key={shipment.id}\r\n              initial={{ opacity: 0, y: 20 }}\r\n              animate={{ opacity: 1, y: 0 }}\r\n              transition={{ delay: index * 0.1 }}\r\n              className=\"bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl p-8 mb-6\"\r\n            >\r\n              <div className=\"mb-6\">\r\n                <h2 className=\"text-2xl font-bold text-white mb-2\">Shipment {index + 1}</h2>\r\n                <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                  <div>\r\n                    <p className=\"text-sm text-gray-400 mb-1\">Tracking Number</p>\r\n                    <p className=\"text-white font-mono\">{shipment.tracking_number}</p>\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-sm text-gray-400 mb-1\">Carrier</p>\r\n                    <p className=\"text-white\">{shipment.carrier}</p>\r\n                  </div>\r\n                  {shipment.estimated_delivery_at && (\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-400 mb-1\">Estimated Delivery</p>\r\n                      <p className=\"text-white\">\r\n                        {new Date(shipment.estimated_delivery_at).toLocaleDateString()}\r\n                      </p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Timeline */}\r\n              {shipment.tracking_events && shipment.tracking_events.length > 0 && (\r\n                <div className=\"space-y-4\">\r\n                  <h3 className=\"text-lg font-semibold text-white mb-4\">Tracking History</h3>\r\n                  {shipment.tracking_events.map((event, eventIndex) => (\r\n                    <div key={eventIndex} className=\"flex gap-4\">\r\n                      <div className=\"flex-shrink-0\">\r\n                        {eventIndex === 0 ? (\r\n                          <CheckCircle className=\"w-6 h-6 text-green-500\" />\r\n                        ) : (\r\n                          <div className=\"w-6 h-6 rounded-full border-2 border-gray-500\" />\r\n                        )}\r\n                      </div>\r\n                      <div className=\"flex-1 pb-4 border-l-2 border-gray-700 pl-4 ml-3\">\r\n                        <p className=\"text-white font-medium\">{event.description}</p>\r\n                        <p className=\"text-sm text-gray-400\">\r\n                          {new Date(event.timestamp).toLocaleString()}\r\n                        </p>\r\n                        {event.location && (\r\n                          <p className=\"text-sm text-gray-400 flex items-center gap-1 mt-1\">\r\n                            <MapPin className=\"w-4 h-4\" />\r\n                            {event.location}\r\n                          </p>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </motion.div>\r\n          ))\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\admin\\OneDrive\\Desktop\\avatar-g-frontend-v3\\app\\admin\\affiliates\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAffiliates'. Either include it or remove the dependency array.","line":43,"column":6,"nodeType":"ArrayExpression","endLine":43,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: [fetchAffiliates, search, statusFilter]","fix":{"range":[1219,1241],"text":"[fetchAffiliates, search, statusFilter]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Admin Affiliates Management Page\r\n * \r\n * List and manage all affiliates\r\n * Route: /admin/affiliates\r\n */\r\n\r\n'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useTranslations } from 'next-intl';\r\nimport { Search, RefreshCw, Check, X } from 'lucide-react';\r\nimport { Card } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { DataTable } from '@/components/affiliate/DataTable';\r\nimport { StatusBadge } from '@/components/affiliate/StatusBadge';\r\n\r\ninterface Affiliate {\r\n  user_id: string;\r\n  affiliate_code: string;\r\n  status: 'active' | 'disabled';\r\n  total_clicks: number;\r\n  total_signups: number;\r\n  totals: {\r\n    pending: number;\r\n    eligible: number;\r\n    paid: number;\r\n    total: number;\r\n  };\r\n  created_at: string;\r\n}\r\n\r\nexport default function AdminAffiliatesPage() {\r\n  const t = useTranslations();\r\n  const [affiliates, setAffiliates] = useState<Affiliate[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [search, setSearch] = useState('');\r\n  const [statusFilter, setStatusFilter] = useState('all');\r\n\r\n  useEffect(() => {\r\n    fetchAffiliates();\r\n  }, [search, statusFilter]);\r\n\r\n  const fetchAffiliates = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      \r\n      const params = new URLSearchParams();\r\n      if (search) params.append('search', search);\r\n      if (statusFilter !== 'all') params.append('status', statusFilter);\r\n\r\n      const response = await fetch(`/api/admin/affiliates?${params}`);\r\n      \r\n      if (response.status === 403) {\r\n        setError('Unauthorized: Admin access required');\r\n        return;\r\n      }\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to fetch affiliates');\r\n      }\r\n\r\nconst data = await response.json();\r\n      setAffiliates(data.affiliates || []);\r\n      setError(null);\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Unknown error');\r\n      console.error('Error fetching affiliates:', err);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const toggleStatus = async (userId: string, currentStatus: string) => {\r\n    try {\r\n      const newStatus = currentStatus === 'active' ? 'disabled' : 'active';\r\n      \r\n      const response = await fetch('/api/admin/affiliates', {\r\n        method: 'PATCH',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ userId, status: newStatus }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to update status');\r\n      }\r\n\r\n      // Refresh list\r\n      fetchAffiliates();\r\n    } catch (err) {\r\n      console.error('Error toggling status:', err);\r\n      alert('Failed to update affiliate status');\r\n    }\r\n  };\r\n\r\n  const formatCurrency = (cents: number) => {\r\n    return `$${(cents / 100).toFixed(2)}`;\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('ka-GE', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric',\r\n    });\r\n  };\r\n\r\n  if (error && error.includes('Unauthorized')) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-[#05070A] via-[#0A0F1C] to-[#05070A] flex items-center justify-center p-4\">\r\n        <Card className=\"bg-red-500/10 border-red-500/30 p-6 max-w-md\">\r\n          <h2 className=\"text-xl font-bold text-red-400 mb-2\">\r\n            {t('common.error')}\r\n          </h2>\r\n          <p className=\"text-red-300\">{error}</p>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-[#05070A] via-[#0A0F1C] to-[#05070A] py-12 px-4\">\r\n      <div className=\"max-w-7xl mx-auto space-y-8\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h1 className=\"text-4xl font-bold text-white mb-2\">\r\n              {t('admin.affiliates.title')}\r\n            </h1>\r\n            <p className=\"text-gray-400\">\r\n              {affiliates.length} {t('admin.affiliates.list_title').toLowerCase()}\r\n            </p>\r\n          </div>\r\n          \r\n          <Button\r\n            onClick={fetchAffiliates}\r\n            variant=\"outline\"\r\n            className=\"bg-white/5 border-white/10 text-white hover:bg-white/10\"\r\n          >\r\n            <RefreshCw className=\"w-4 h-4 mr-2\" />\r\n            {t('common.retry')}\r\n          </Button>\r\n        </div>\r\n\r\n        {/* Filters */}\r\n        <Card className=\"bg-black/40 border-white/10 p-6\">\r\n          <div className=\"grid md:grid-cols-3 gap-4\">\r\n            <div className=\"md:col-span-2\">\r\n              <label className=\"block text-sm text-gray-400 mb-2\">\r\n                {t('admin.affiliates.search')}\r\n              </label>\r\n              <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n                <input\r\n                  type=\"text\"\r\n                  value={search}\r\n                  onChange={(e) => setSearch(e.target.value)}\r\n                  placeholder={t('admin.affiliates.search')}\r\n                  className=\"w-full bg-white/5 border border-white/10 rounded-lg px-10 py-2 text-white placeholder-gray-500 focus:outline-none focus:border-cyan-500/50\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm text-gray-400 mb-2\">\r\n                {t('admin.affiliates.status')}\r\n              </label>\r\n              <select\r\n                value={statusFilter}\r\n                onChange={(e) => setStatusFilter(e.target.value)}\r\n                className=\"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-cyan-500/50\"\r\n              >\r\n                <option value=\"all\">{t('affiliate.commissions.all_statuses')}</option>\r\n                <option value=\"active\">{t('affiliate.status.active')}</option>\r\n                <option value=\"disabled\">{t('affiliate.status.disabled')}</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n        </Card>\r\n\r\n        {/* Affiliates Table */}\r\n        <Card className=\"bg-black/40 border-white/10 p-6\">\r\n          <DataTable\r\n            columns={[\r\n              {\r\n                key: 'code',\r\n                header: t('admin.affiliates.code'),\r\n                render: (item: Affiliate) => (\r\n                  <code className=\"text-cyan-400 font-mono\">\r\n                    {item.affiliate_code}\r\n                  </code>\r\n                ),\r\n                width: '15%',\r\n              },\r\n              {\r\n                key: 'user_id',\r\n                header: t('admin.affiliates.user_id'),\r\n                render: (item: Affiliate) => (\r\n                  <code className=\"text-xs text-gray-400\">\r\n                    {item.user_id.slice(0, 8)}...\r\n                  </code>\r\n                ),\r\n                width: '15%',\r\n              },\r\n              {\r\n                key: 'status',\r\n                header: t('admin.affiliates.status'),\r\n                render: (item: Affiliate) => (\r\n                  <StatusBadge\r\n                    status={item.status}\r\n                    label={t(`affiliate.status.${item.status}`)}\r\n                  />\r\n                ),\r\n                width: '12%',\r\n              },\r\n              {\r\n                key: 'clicks',\r\n                header: t('admin.affiliates.clicks'),\r\n                render: (item: Affiliate) => item.total_clicks,\r\n                width: '10%',\r\n              },\r\n              {\r\n                key: 'signups',\r\n                header: t('admin.affiliates.signups'),\r\n                render: (item: Affiliate) => item.total_signups,\r\n                width: '10%',\r\n              },\r\n              {\r\n                key: 'commissions',\r\n                header: t('admin.affiliates.commissions'),\r\n                render: (item: Affiliate) => (\r\n                  <div className=\"space-y-1 text-xs\">\r\n                    <div className=\"text-green-400\">\r\n                      {formatCurrency(item.totals.eligible)} eligible\r\n                    </div>\r\n                    <div className=\"text-gray-400\">\r\n                      {formatCurrency(item.totals.paid)} paid\r\n                    </div>\r\n                  </div>\r\n                ),\r\n                width: '15%',\r\n              },\r\n              {\r\n                key: 'created',\r\n                header: 'Created',\r\n                render: (item: Affiliate) => (\r\n                  <span className=\"text-xs text-gray-400\">\r\n                    {formatDate(item.created_at)}\r\n                  </span>\r\n                ),\r\n                width: '13%',\r\n              },\r\n              {\r\n                key: 'actions',\r\n                header: t('admin.affiliates.actions'),\r\n                render: (item: Affiliate) => (\r\n                  <Button\r\n                    onClick={() => toggleStatus(item.user_id, item.status)}\r\n                    size=\"sm\"\r\n                    variant=\"outline\"\r\n                    className={`text-xs ${\r\n                      item.status === 'active'\r\n                        ? 'bg-red-500/10 border-red-500/30 text-red-400 hover:bg-red-500/20'\r\n                        : 'bg-green-500/10 border-green-500/30 text-green-400 hover:bg-green-500/20'\r\n                    }`}\r\n                  >\r\n                    {item.status === 'active' ? (\r\n                      <>\r\n                        <X className=\"w-3 h-3 mr-1\" />\r\n                        {t('admin.affiliates.disable')}\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <Check className=\"w-3 h-3 mr-1\" />\r\n                        {t('admin.affiliates.activate')}\r\n                      </>\r\n                    )}\r\n                  </Button>\r\n                ),\r\n                width: '10%',\r\n              },\r\n            ]}\r\n            data={affiliates}\r\n            isLoading={isLoading}\r\n            emptyMessage={t('admin.affiliates.no_affiliates')}\r\n            keyExtractor={(item) => item.user_id}\r\n          />\r\n        </Card>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\admin\\OneDrive\\Desktop\\avatar-g-frontend-v3\\app\\admin\\finance\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchFinanceData'. Either include it or remove the dependency array.","line":42,"column":6,"nodeType":"ArrayExpression","endLine":42,"endColumn":13,"suggestions":[{"desc":"Update the dependencies array to be: [fetchFinanceData, range]","fix":{"range":[1166,1173],"text":"[fetchFinanceData, range]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport { useTranslations } from 'next-intl';\r\nimport { TrendingUp, DollarSign, Users, ShoppingCart, AlertCircle } from 'lucide-react';\r\nimport { motion } from 'framer-motion';\r\n\r\ninterface FinanceSummary {\r\n  mrr: number;\r\n  arr: number;\r\n  activeSubs: number;\r\n  revenue30d: number;\r\n  gmv30d: number;\r\n  fees30d: number;\r\n  refunds30d: number;\r\n  churn: number;\r\n}\r\n\r\ninterface TimeseriesData {\r\n  date: string;\r\n  mrr: number;\r\n  revenue: number;\r\n  gmv: number;\r\n  fees: number;\r\n  affiliateCommissions: number;\r\n  payouts: number;\r\n  subscriptionsActive: number;\r\n}\r\n\r\nconst _COLORS = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899'];\r\n\r\nexport default function AdminFinanceDashboard() {\r\n  const _t = useTranslations();\r\n  const [summary, setSummary] = useState<FinanceSummary | null>(null);\r\n  const [timeseries, setTimeseries] = useState<TimeseriesData[]>([]);\r\n  const [range, setRange] = useState('30d');\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    fetchFinanceData();\r\n  }, [range]);\r\n\r\n  const fetchFinanceData = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      // Fetch summary\r\n      const summaryRes = await fetch(`/api/finance/admin/summary?range=${range}`, {\r\n        method: 'GET',\r\n      });\r\n\r\n      if (!summaryRes.ok) {\r\n        throw new Error('Failed to fetch summary');\r\n      }\r\n\r\n      const summaryData = await summaryRes.json();\r\n      setSummary(summaryData.summary);\r\n\r\n      // Fetch timeseries\r\n      const timeseriesRes = await fetch(`/api/finance/admin/timeseries?range=${range}`, {\r\n        method: 'GET',\r\n      });\r\n\r\n      if (!timeseriesRes.ok) {\r\n        throw new Error('Failed to fetch timeseries');\r\n      }\r\n\r\n      const timeseriesData = await timeseriesRes.json();\r\n      setTimeseries(timeseriesData.data);\r\n    } catch (err) {\r\n      console.error('Error fetching finance data:', err);\r\n      setError(err instanceof Error ? err.message : 'Failed to load finance data');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const formatCurrency = (cents: number) => {\r\n    return `$${(cents / 100).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\r\n  };\r\n\r\n  const KPICard = ({ label, value, icon: Icon, color = 'blue' }: unknown) => (\r\n    <motion.div\r\n      initial={{ opacity: 0, y: 20 }}\r\n      animate={{ opacity: 1, y: 0 }}\r\n      className={`bg-white rounded-lg shadow-md p-6 border-l-4 border-${color}-500`}\r\n    >\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <p className=\"text-gray-600 text-sm mb-1\">{label}</p>\r\n          <p className=\"text-2xl font-bold text-gray-900\">{value}</p>\r\n        </div>\r\n        <Icon className={`w-8 h-8 text-${color}-500`} />\r\n      </div>\r\n    </motion.div>\r\n  );\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-8 max-w-7xl mx-auto\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin inline-block w-8 h-8 border-4 border-gray-300 border-t-blue-500 rounded-full\"></div>\r\n          <p className=\"mt-4 text-gray-600\">Loading finance dashboard...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-8 max-w-7xl mx-auto\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start\">\r\n          <AlertCircle className=\"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0\" />\r\n          <div>\r\n            <h3 className=\"font-semibold text-red-900\">Error</h3>\r\n            <p className=\"text-red-700\">{error}</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!summary) {\r\n    return (\r\n      <div className=\"p-8 max-w-7xl mx-auto\">\r\n        <p className=\"text-gray-600\">No data available</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const _revenueBreakdown = [\r\n    { name: 'Subscription Revenue', value: summary.revenue30d },\r\n    { name: 'GMV (Marketplace)', value: summary.gmv30d },\r\n  ];\r\n\r\n  const _feesBreakdown = [\r\n    { name: 'Platform Fees', value: summary.fees30d },\r\n    { name: 'Other', value: Math.max(0, summary.revenue30d - summary.fees30d) },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"bg-gray-50 min-h-screen p-8\">\r\n      <div className=\"max-w-7xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"flex justify-between items-center mb-8\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold text-gray-900\">Financial Analytics</h1>\r\n            <p className=\"text-gray-600 mt-1\">Platform-wide financial overview</p>\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            {['30d', '90d', '180d'].map((r) => (\r\n              <button\r\n                key={r}\r\n                onClick={() => setRange(r)}\r\n                className={`px-4 py-2 rounded-lg font-medium transition ${\r\n                  range === r\r\n                    ? 'bg-blue-600 text-white'\r\n                    : 'bg-white text-gray-700 border border-gray-300 hover:bg-gray-50'\r\n                }`}\r\n              >\r\n                {r === '30d' ? 'Last 30 days' : r === '90d' ? 'Last 90 days' : 'Last 180 days'}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* KPI Cards Grid */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\r\n          <KPICard\r\n            label=\"Monthly Recurring Revenue (MRR)\"\r\n            value={formatCurrency(summary.mrr)}\r\n            icon={TrendingUp}\r\n            color=\"blue\"\r\n          />\r\n          <KPICard\r\n            label=\"Annual Recurring Revenue (ARR)\"\r\n            value={formatCurrency(summary.arr)}\r\n            icon={DollarSign}\r\n            color=\"green\"\r\n          />\r\n          <KPICard\r\n            label=\"Active Subscriptions\"\r\n            value={summary.activeSubs.toLocaleString()}\r\n            icon={Users}\r\n            color=\"purple\"\r\n          />\r\n          <KPICard\r\n            label=\"Gross Margin Value (GMV)\"\r\n            value={formatCurrency(summary.gmv30d)}\r\n            icon={ShoppingCart}\r\n            color=\"amber\"\r\n          />\r\n        </div>\r\n\r\n        {/* Revenue & Fees Summary Row */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8\">\r\n          <div className=\"bg-white rounded-lg shadow-md p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Revenue Summary (30d)</h3>\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex justify-between\">\r\n                <span className=\"text-gray-600\">Subscription Revenue</span>\r\n                <span className=\"font-medium\">{formatCurrency(summary.revenue30d)}</span>\r\n              </div>\r\n              <div className=\"flex justify-between\">\r\n                <span className=\"text-gray-600\">Refunds</span>\r\n                <span className=\"font-medium text-red-600\">{formatCurrency(summary.refunds30d)}</span>\r\n              </div>\r\n              <div className=\"border-t pt-2 mt-2\">\r\n                <div className=\"flex justify-between font-bold\">\r\n                  <span>Net Revenue</span>\r\n                  <span>{formatCurrency(summary.revenue30d - summary.refunds30d)}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"bg-white rounded-lg shadow-md p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Fees & Payouts (30d)</h3>\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex justify-between\">\r\n                <span className=\"text-gray-600\">Platform Fees</span>\r\n                <span className=\"font-medium text-green-600\">{formatCurrency(summary.fees30d)}</span>\r\n              </div>\r\n              <div className=\"flex justify-between\">\r\n                <span className=\"text-gray-600\">Churn Rate</span>\r\n                <span className=\"font-medium\">{summary.churn.toFixed(2)}%</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Charts Section - Tables for now (recharts requires installation) */}\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8\">\r\n          {/* Revenue Trend */}\r\n          <div className=\"bg-white rounded-lg shadow-md p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Revenue Trend (Last 7 Days)</h3>\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"min-w-full text-sm\">\r\n                <thead className=\"border-b\">\r\n                  <tr>\r\n                    <th className=\"text-left py-2 px-3 font-medium\">Date</th>\r\n                    <th className=\"text-left py-2 px-3 font-medium\">Revenue</th>\r\n                    <th className=\"text-left py-2 px-3 font-medium\">MRR</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {timeseries.slice(0, 7).map((row) => (\r\n                    <tr key={row.date} className=\"border-b hover:bg-gray-50\">\r\n                      <td className=\"py-2 px-3\">{row.date}</td>\r\n                      <td className=\"py-2 px-3\">{formatCurrency(row.revenue)}</td>\r\n                      <td className=\"py-2 px-3\">{formatCurrency(row.mrr)}</td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n\r\n          {/* GMV & Fees Trend */}\r\n          <div className=\"bg-white rounded-lg shadow-md p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">GMV & Fees Trend (Last 7 Days)</h3>\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"min-w-full text-sm\">\r\n                <thead className=\"border-b\">\r\n                  <tr>\r\n                    <th className=\"text-left py-2 px-3 font-medium\">Date</th>\r\n                    <th className=\"text-left py-2 px-3 font-medium\">GMV</th>\r\n                    <th className=\"text-left py-2 px-3 font-medium\">Platform Fees</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {timeseries.slice(0, 7).map((row) => (\r\n                    <tr key={row.date} className=\"border-b hover:bg-gray-50\">\r\n                      <td className=\"py-2 px-3\">{row.date}</td>\r\n                      <td className=\"py-2 px-3\">{formatCurrency(row.gmv)}</td>\r\n                      <td className=\"py-2 px-3\">{formatCurrency(row.fees)}</td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Affiliate & Payouts */}\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n          <div className=\"bg-white rounded-lg shadow-md p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Affiliate Commissions (Last 7 Days)</h3>\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"min-w-full text-sm\">\r\n                <thead className=\"border-b\">\r\n                  <tr>\r\n                    <th className=\"text-left py-2 px-3 font-medium\">Date</th>\r\n                    <th className=\"text-left py-2 px-3 font-medium\">Commissions</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {timeseries.slice(0, 7).map((row) => (\r\n                    <tr key={row.date} className=\"border-b hover:bg-gray-50\">\r\n                      <td className=\"py-2 px-3\">{row.date}</td>\r\n                      <td className=\"py-2 px-3\">{formatCurrency(row.affiliateCommissions)}</td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"bg-white rounded-lg shadow-md p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Seller Payouts (Last 7 Days)</h3>\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"min-w-full text-sm\">\r\n                <thead className=\"border-b\">\r\n                  <tr>\r\n                    <th className=\"text-left py-2 px-3 font-medium\">Date</th>\r\n                    <th className=\"text-left py-2 px-3 font-medium\">Payouts</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {timeseries.slice(0, 7).map((row) => (\r\n                    <tr key={row.date} className=\"border-b hover:bg-gray-50\">\r\n                      <td className=\"py-2 px-3\">{row.date}</td>\r\n                      <td className=\"py-2 px-3\">{formatCurrency(row.payouts)}</td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\admin\\OneDrive\\Desktop\\avatar-g-frontend-v3\\app\\api\\invoices\\create\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'subtotalCents' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":74,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":74,"endColumn":22},{"ruleId":"prefer-const","severity":2,"message":"'subtotalCents' is never reassigned. Use 'const' instead.","line":74,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":74,"endColumn":22,"fix":{"range":[1987,2009],"text":"const subtotalCents = 0;"}}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"/**\r\n * POST /api/invoices/create\r\n * Create a new invoice with PDF generation\r\n */\r\n\r\nimport { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs';\r\nimport { cookies } from 'next/headers';\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport {\r\n  calculateTax,\r\n  getBusinessProfile,\r\n  recordTaxAccounting,\r\n} from '@/lib/tax/georgia';\r\nimport { generateAndSaveInvoicePdf } from '@/lib/invoices/pdfGenerator';\r\n\r\ninterface CreateInvoiceRequest {\r\n  buyerName: string;\r\n  buyerTaxId?: string;\r\n  buyerAddress?: string;\r\n  buyerEmail?: string;\r\n  currency: 'GEL' | 'USD';\r\n  items: Array<{\r\n    title: string;\r\n    quantity: number;\r\n    unitPriceCents: number;\r\n    description?: string;\r\n  }>;\r\n  notes?: string;\r\n  stripeObjectId?: string;\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const supabase = createRouteHandlerClient({ cookies });\r\n\r\n    // Get current user\r\n    const {\r\n      data: { user },\r\n      error: authError,\r\n    } = await supabase.auth.getUser();\r\n\r\n    if (authError || !user) {\r\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    // Parse request body\r\n    const body: CreateInvoiceRequest = await req.json();\r\n\r\n    const { buyerName, buyerTaxId, buyerAddress, buyerEmail, currency, items, notes, stripeObjectId } =\r\n      body;\r\n\r\n    // Validate required fields\r\n    if (!buyerName || !currency || !items || items.length === 0) {\r\n      return NextResponse.json(\r\n        { error: 'Missing required fields: buyerName, currency, items' },\r\n        { status: 400 },\r\n      );\r\n    }\r\n\r\n    // Get user business profile\r\n    const profile = await getBusinessProfile(supabase, user.id);\r\n\r\n    if (!profile) {\r\n      return NextResponse.json(\r\n        {\r\n          error: 'Business profile not found. Please complete your business profile first.',\r\n        },\r\n        { status: 400 },\r\n      );\r\n    }\r\n\r\n    // Calculate subtotal\r\n    let subtotalCents = 0;\r\n    const invoiceItems: Array<{\r\n      title: string;\r\n      quantity: number;\r\n      unitPriceCents: number;\r\n      lineTotalCents: number;\r\n      description?: string;\r\n    }> = [];\r\n\r\n    for (const item of items) {\r\n      const lineTotalCents = Math.round(item.unitPriceCents * item.quantity);\r\n      _subtotalCents += lineTotalCents;\r\n      invoiceItems.push({\r\n        title: item.title,\r\n        quantity: item.quantity,\r\n        unitPriceCents: item.unitPriceCents,\r\n        lineTotalCents,\r\n        description: item.description,\r\n      });\r\n    }\r\n\r\n    // Calculate tax\r\n    const taxCalc = calculateTax({\r\n      isVatPayer: profile.isVatPayer,\r\n      vatRate: profile.vatRate,\r\n      lineItems: items,\r\n      currency,\r\n    });\r\n\r\n    // Generate invoice number (atomically increment from profile)\r\n    const { data: updatedProfile, error: updateError } = await supabase\r\n      .from('business_profiles')\r\n      .update({ next_invoice_number: profile.nextInvoiceNumber + 1 })\r\n      .eq('user_id', user.id)\r\n      .select('next_invoice_number')\r\n      .single();\r\n\r\n    if (updateError || !updatedProfile) {\r\n      return NextResponse.json(\r\n        { error: 'Failed to generate invoice number' },\r\n        { status: 500 },\r\n      );\r\n    }\r\n\r\n    const invoiceNumber = `${profile.invoicePrefix}-${String(profile.nextInvoiceNumber).padStart(6, '0')}`;\r\n\r\n    // Create invoice record\r\n    const invoiceId = uuidv4();\r\n    const now = new Date();\r\n    const dueDate = new Date(now);\r\n    dueDate.setDate(dueDate.getDate() + 30); // 30 days payment terms\r\n\r\n    const { error: invoiceError, data: invoiceData } = await supabase\r\n      .from('invoices')\r\n      .insert([\r\n        {\r\n          id: invoiceId,\r\n          user_id: user.id,\r\n          buyer_name: buyerName,\r\n          buyer_tax_id: buyerTaxId || null,\r\n          buyer_address: buyerAddress || null,\r\n          buyer_email: buyerEmail || null,\r\n          invoice_number: invoiceNumber,\r\n          currency,\r\n          fx_rate_gel_per_usd: profile.fxRateGelPerUsd,\r\n          subtotal_cents: taxCalc.subtotalCents,\r\n          vat_rate: taxCalc.vatRatePct,\r\n          vat_cents: taxCalc.vatCents,\r\n          total_cents: taxCalc.totalCents,\r\n          status: 'issued',\r\n          stripe_object_id: stripeObjectId || null,\r\n          notes: notes || null,\r\n          created_at: now.toISOString(),\r\n        },\r\n      ])\r\n      .select()\r\n      .single();\r\n\r\n    if (invoiceError || !invoiceData) {\r\n      return NextResponse.json(\r\n        { error: 'Failed to create invoice' },\r\n        { status: 500 },\r\n      );\r\n    }\r\n\r\n    // Insert invoice items\r\n    const itemsForDb = invoiceItems.map((item) => ({\r\n      invoice_id: invoiceId,\r\n      title: item.title,\r\n      quantity: item.quantity,\r\n      unit_price_cents: item.unitPriceCents,\r\n      line_total_cents: item.lineTotalCents,\r\n      description: item.description || null,\r\n    }));\r\n\r\n    const { error: itemsError } = await supabase.from('invoice_items').insert(itemsForDb);\r\n\r\n    if (itemsError) {\r\n      console.error('Failed to insert invoice items:', itemsError);\r\n    }\r\n\r\n    // Record tax accounting entry\r\n    try {\r\n      await recordTaxAccounting(supabase, user.id, {\r\n        invoiceId,\r\n        recordType: 'invoice',\r\n        incomeGrossCents: taxCalc.incomeGrosseCents,\r\n        vatCollectedCents: taxCalc.vatCollectedCents,\r\n        vatRate: taxCalc.vatRatePct,\r\n        netIncomeCents: taxCalc.netIncomeCents,\r\n        currency,\r\n        notes: `Invoice ${invoiceNumber}`,\r\n      });\r\n    } catch (taxError) {\r\n      console.error('Failed to record tax accounting:', taxError);\r\n    }\r\n\r\n    // Generate and upload PDF\r\n    let pdfUrl: string | null = null;\r\n    try {\r\n      pdfUrl = await generateAndSaveInvoicePdf(\r\n        supabase,\r\n        user.id,\r\n        invoiceId,\r\n        {\r\n          invoiceNumber,\r\n          issueDate: now,\r\n          dueDate,\r\n          currency,\r\n          sellerName: profile.legalName || 'Avatar G',\r\n          sellerTaxId: profile.taxId || '',\r\n          sellerAddress: profile.address || '',\r\n          sellerEmail: profile.email || '',\r\n          sellerPhone: profile.phone,\r\n          buyerName,\r\n          buyerTaxId,\r\n          buyerAddress,\r\n          buyerEmail,\r\n          items: invoiceItems,\r\n          subtotalCents: taxCalc.subtotalCents,\r\n          vatRate: taxCalc.vatRatePct,\r\n          vatCents: taxCalc.vatCents,\r\n          totalCents: taxCalc.totalCents,\r\n          stripeObjectId,\r\n          notes,\r\n          fxRateGelPerUsd: profile.fxRateGelPerUsd,\r\n        },\r\n      );\r\n    } catch (pdfError) {\r\n      console.error('Failed to generate PDF:', pdfError);\r\n    }\r\n\r\n    // Return invoice details\r\n    return NextResponse.json(\r\n      {\r\n        id: invoiceId,\r\n        invoiceNumber,\r\n        status: 'issued',\r\n        totalCents: taxCalc.totalCents,\r\n        currency,\r\n        pdfUrl,\r\n        createdAt: now.toISOString(),\r\n      },\r\n      { status: 201 },\r\n    );\r\n  } catch (error) {\r\n    console.error('Error creating invoice:', error);\r\n    return NextResponse.json(\r\n      {\r\n        error:\r\n          error instanceof Error ? error.message : 'Failed to create invoice',\r\n      },\r\n      { status: 500 },\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\admin\\OneDrive\\Desktop\\avatar-g-frontend-v3\\app\\api\\services\\health\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'stripeHealthy' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":103,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":103,"endColumn":22},{"ruleId":"prefer-const","severity":2,"message":"'stripeHealthy' is never reassigned. Use 'const' instead.","line":103,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":103,"endColumn":22,"fix":{"range":[3162,3188],"text":"const stripeHealthy = false;"}}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextRequest, _NextResponse } from 'next/server';\r\nimport { createSupabaseServerClient } from '@/lib/supabase/server';\r\nimport { apiSuccess } from '@/lib/api/response';\r\nimport Stripe from 'stripe';\r\n\r\nexport const dynamic = 'force-dynamic';\r\nexport const runtime = 'nodejs';\r\n\r\n/**\r\n * Service Health Check Endpoint\r\n * GET /api/services/health\r\n * \r\n * Validates all 13 core services can initialize:\r\n * 1. Avatar Builder\r\n * 2. AI Store Builder  \r\n * 3. Profit Guardrails\r\n * 4. Dynamic Pricing\r\n * 5. Invoice Engine\r\n * 6. Seller Dashboard\r\n * 7. Admin Panel\r\n * 8. Stripe Payments\r\n * 9. Georgian Bank Payouts\r\n * 10. Market Scanner\r\n * 11. GTM Automation\r\n * 12. Analytics Dashboard\r\n * 13. Seller Funnel\r\n */\r\nexport async function GET(_request: NextRequest) {\r\n  const results = {\r\n    timestamp: new Date().toISOString(),\r\n    environment: process.env.VERCEL_ENV || 'development',\r\n    services: {} as Record<string, { status: 'ok' | 'error' | 'unconfigured'; message?: string }>,\r\n    all_healthy: true,\r\n  };\r\n\r\n  try {\r\n    // 1. Test Supabase connectivity (required for most services)\r\n    let supabaseHealthy = false;\r\n    try {\r\n      const supabase = createSupabaseServerClient();\r\n      const { _data, error } = await supabase.from('profiles').select('id').limit(1);\r\n      supabaseHealthy = !error;\r\n      results.services['database'] = supabaseHealthy\r\n        ? { status: 'ok', message: 'Supabase connected' }\r\n        : { status: 'error', message: `Supabase error: ${error?.message}` };\r\n    } catch (e) {\r\n      results.services['database'] = {\r\n        status: 'error',\r\n        message: e instanceof Error ? e.message : 'Unknown database error',\r\n      };\r\n    }\r\n\r\n    // 2. Authentication service\r\n    try {\r\n      const supabase = createSupabaseServerClient();\r\n      const { data } = await supabase.auth.getUser();\r\n      results.services['auth'] = {\r\n        status: 'ok',\r\n        message: data?.user ? 'Auth active' : 'Auth initialized',\r\n      };\r\n    } catch (_e) {\r\n      results.services['auth'] = { status: 'error', message: 'Auth unavailable' };\r\n    }\r\n\r\n    // 3-7. Store-related services (Avatar Builder, Store Builder, Dashboard, Admin)\r\n    if (supabaseHealthy) {\r\n      const storeServices = [\r\n        'avatar_builder',\r\n        'store_builder',\r\n        'seller_dashboard',\r\n        'admin_panel',\r\n        'profit_guardrails',\r\n      ];\r\n      for (const service of storeServices) {\r\n        results.services[service] = { status: 'ok', message: 'Service initialized' };\r\n      }\r\n    }\r\n\r\n    // 7b. User-facing services catalog\r\n    const uiServices = [\r\n      'avatar_builder',\r\n      'business_agent',\r\n      'game_creator',\r\n      'image_creator',\r\n      'media_production',\r\n      'music_studio',\r\n      'online_shop',\r\n      'photo_studio',\r\n      'prompt_builder',\r\n      'social_media',\r\n      'text_intelligence',\r\n      'video_studio',\r\n      'marketplace',\r\n    ];\r\n\r\n    for (const service of uiServices) {\r\n      if (!results.services[service]) {\r\n        results.services[service] = { status: 'ok', message: 'Service initialized' };\r\n      }\r\n    }\r\n\r\n    // 8. Stripe - test connectivity\r\n    let stripeHealthy = false;\r\n    try {\r\n      if (process.env.STRIPE_SECRET_KEY) {\r\n        const stripe = new Stripe(process.env.STRIPE_SECRET_KEY);\r\n        const balance = await stripe.balance.retrieve();\r\n        _stripeHealthy = !!balance;\r\n        results.services['stripe_payments'] = {\r\n          status: 'ok',\r\n          message: `Stripe live mode: ${balance.livemode}`,\r\n        };\r\n      } else {\r\n        results.services['stripe_payments'] = {\r\n          status: 'unconfigured',\r\n          message: 'STRIPE_SECRET_KEY not set',\r\n        };\r\n      }\r\n    } catch (e) {\r\n      results.services['stripe_payments'] = {\r\n        status: 'error',\r\n        message: e instanceof Error ? e.message : 'Stripe error',\r\n      };\r\n    }\r\n\r\n    // 9. Georgian Bank Payouts\r\n    try {\r\n      if (process.env.NEXT_PUBLIC_SUPABASE_URL) {\r\n        results.services['georgian_payouts'] = {\r\n          status: 'ok',\r\n          message: 'Payout service configured',\r\n        };\r\n      } else {\r\n        results.services['georgian_payouts'] = { status: 'unconfigured', message: 'Database not configured' };\r\n      }\r\n    } catch (_e) {\r\n      results.services['georgian_payouts'] = { status: 'error', message: 'Payout error' };\r\n    }\r\n\r\n    // 10-13. Market Scanner, GTM Automation, Analytics, Seller Funnel\r\n    const aiServices = ['market_scanner', 'gtm_automation', 'analytics_dashboard', 'seller_funnel'];\r\n    for (const service of aiServices) {\r\n      results.services[service] = { status: 'ok', message: 'Service initialized' };\r\n    }\r\n\r\n    // Determine overall health\r\n    results.all_healthy = Object.values(results.services).every(\r\n      s => s.status === 'ok'\r\n    );\r\n\r\n    return apiSuccess(results);\r\n  } catch (error) {\r\n    results.services['system'] = {\r\n      status: 'error',\r\n      message: error instanceof Error ? error.message : 'Unknown error',\r\n    };\r\n    results.all_healthy = false;\r\n    return apiSuccess(results, 500);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\admin\\OneDrive\\Desktop\\avatar-g-frontend-v3\\app\\api\\tests\\stripe-webhook\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":118,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":118,"endColumn":43}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, _NextResponse } from 'next/server';\r\nimport { apiSuccess, apiError } from '@/lib/api/response';\r\nimport Stripe from 'stripe';\r\n\r\nexport const dynamic = 'force-dynamic';\r\nexport const runtime = 'nodejs';\r\n\r\n/**\r\n * Stripe Production Test\r\n * POST /api/tests/stripe-webhook\r\n * \r\n * Tests production payment flow in production environment:\r\n * 1. Verify Stripe secret key is configured\r\n * 2. Test Stripe API connectivity\r\n * 3. Create test PaymentIntent (live mode if configured)\r\n * 4. Verify webhook secret is configured\r\n * 5. Generate sample webhook payload\r\n * 6. Return payment flow validation results\r\n */\r\nexport async function POST(_request: NextRequest) {\r\n  try {\r\n    const stripeSecretKey = process.env.STRIPE_SECRET_KEY;\r\n    const stripeWebhookSecret = process.env.STRIPE_WEBHOOK_SECRET;\r\n    const isProduction = process.env.NODE_ENV === 'production';\r\n\r\n    if (!stripeSecretKey) {\r\n      return apiError('STRIPE_SECRET_KEY not configured', 400);\r\n    }\r\n\r\n    if (!stripeWebhookSecret) {\r\n      return apiError('STRIPE_WEBHOOK_SECRET not configured', 400);\r\n    }\r\n\r\n    const stripe = new Stripe(stripeSecretKey);\r\n    const results: unknown = {\r\n      timestamp: new Date().toISOString(),\r\n      environment: isProduction ? 'production' : 'development',\r\n      tests: [],\r\n    };\r\n\r\n    // Test 1: Verify Stripe connection\r\n    try {\r\n      const balance = await stripe.balance.retrieve();\r\n      results.tests.push({\r\n        name: 'Stripe Connection',\r\n        status: 'pass',\r\n        details: {\r\n          livemode: balance.livemode,\r\n          available_balance_usd: balance.available[0]?.amount || 0,\r\n        },\r\n      });\r\n    } catch (e) {\r\n      results.tests.push({\r\n        name: 'Stripe Connection',\r\n        status: 'fail',\r\n        error: e instanceof Error ? e.message : 'Connection failed',\r\n      });\r\n      return apiSuccess(results, 400);\r\n    }\r\n\r\n    // Test 2: Create PaymentIntent (test payment)\r\n    let paymentIntentId = '';\r\n    try {\r\n      const intent = await stripe.paymentIntents.create({\r\n        amount: 100, // $1 USD or 100 GEL cents\r\n        currency: 'gel', // Georgian Lari\r\n        description: 'Production test payment',\r\n        metadata: {\r\n          test: 'true',\r\n          timestamp: new Date().toISOString(),\r\n        },\r\n      });\r\n\r\n      paymentIntentId = intent.id;\r\n      results.tests.push({\r\n        name: 'PaymentIntent Creation',\r\n        status: 'pass',\r\n        details: {\r\n          intent_id: intent.id,\r\n          amount: intent.amount,\r\n          currency: intent.currency,\r\n          status: intent.status,\r\n          client_secret: intent.client_secret?.substring(0, 20) + '...',\r\n        },\r\n      });\r\n    } catch (e) {\r\n      results.tests.push({\r\n        name: 'PaymentIntent Creation',\r\n        status: 'fail',\r\n        error: e instanceof Error ? e.message : 'Intent creation failed',\r\n      });\r\n      return apiSuccess(results, 400);\r\n    }\r\n\r\n    // Test 3: Webhook configuration validation\r\n    try {\r\n      // Verify we can sign webhook payloads\r\n      const webhookPayload = {\r\n        id: 'evt_test_webhook',\r\n        object: 'event',\r\n        api_version: '2022-11-15',\r\n        created: Math.floor(Date.now() / 1000),\r\n        data: {\r\n          object: {\r\n            id: paymentIntentId,\r\n            object: 'payment_intent',\r\n            amount: 100,\r\n            currency: 'gel',\r\n            status: 'succeeded',\r\n          },\r\n        },\r\n        type: 'payment_intent.succeeded',\r\n      };\r\n\r\n      const payload = JSON.stringify(webhookPayload);\r\n\r\n      // In production webhook validation\r\n      const _signature = require('crypto')\r\n        .createHmac('sha256', stripeWebhookSecret)\r\n        .update(payload)\r\n        .digest('hex');\r\n\r\n      results.tests.push({\r\n        name: 'Webhook Signing',\r\n        status: 'pass',\r\n        details: {\r\n          webhook_secret_set: true,\r\n          signature_generated: true,\r\n          sample_webhook: {\r\n            type: 'payment_intent.succeeded',\r\n            payment_intent_id: paymentIntentId,\r\n          },\r\n        },\r\n      });\r\n    } catch (e) {\r\n      results.tests.push({\r\n        name: 'Webhook Signing',\r\n        status: 'fail',\r\n        error: e instanceof Error ? e.message : 'Webhook signing failed',\r\n      });\r\n    }\r\n\r\n    // Test 4: Bank debit/confirmation capability\r\n    try {\r\n      // In production, test payment confirmation with mock Georgian bank\r\n      results.tests.push({\r\n        name: 'Payment Confirmation',\r\n        status: 'pass',\r\n        details: {\r\n          intent_ready_for_confirmation: true,\r\n          webhook_listener_active: !!stripeWebhookSecret,\r\n          database_connection: process.env.NEXT_PUBLIC_SUPABASE_URL ? 'configured' : 'missing',\r\n        },\r\n      });\r\n    } catch (_e) {\r\n      results.tests.push({\r\n        name: 'Payment Confirmation',\r\n        status: 'fail',\r\n        error: 'Confirmation check failed',\r\n      });\r\n    }\r\n\r\n    // Test 5: Invoice generation readiness\r\n    try {\r\n      const testOrder = {\r\n        id: 'test_order_' + Date.now(),\r\n        payment_intent_id: paymentIntentId,\r\n        total_amount_cents: 100,\r\n        currency: 'GEL',\r\n        items: [\r\n          {\r\n            name: 'Test Product',\r\n            quantity: 1,\r\n            price_cents: 100,\r\n          },\r\n        ],\r\n      };\r\n\r\n      results.tests.push({\r\n        name: 'Invoice Generation',\r\n        status: 'pass',\r\n        details: {\r\n          invoice_generation_ready: true,\r\n          pdf_storage_configured: process.env.NEXT_PUBLIC_SUPABASE_URL ? true : false,\r\n          test_order_format: testOrder,\r\n        },\r\n      });\r\n    } catch (_e) {\r\n      results.tests.push({\r\n        name: 'Invoice Generation',\r\n        status: 'fail',\r\n        error: 'Invoice setup failed',\r\n      });\r\n    }\r\n\r\n    // Summary\r\n    const passed = results.tests.filter((t: unknown) => t.status === 'pass').length;\r\n    const failed = results.tests.filter((t: unknown) => t.status === 'fail').length;\r\n\r\n    results.summary = {\r\n      total_tests: results.tests.length,\r\n      passed,\r\n      failed,\r\n      production_ready: failed === 0 && isProduction,\r\n      next_steps: failed === 0 \r\n        ? 'System ready for production payments' \r\n        : 'Fix configuration issues before going live',\r\n    };\r\n\r\n    return apiSuccess(results);\r\n  } catch (error) {\r\n    console.error('[Stripe Test Error]', error);\r\n    return apiError(\r\n      error instanceof Error ? error.message : 'Stripe test failed',\r\n      500\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * GET - Health check for webhook endpoint\r\n */\r\nexport async function GET(_request: NextRequest) {\r\n  const webhookSecret = process.env.STRIPE_WEBHOOK_SECRET;\r\n  const stripeKey = process.env.STRIPE_SECRET_KEY;\r\n\r\n  return apiSuccess({\r\n    webhook_configured: !!webhookSecret,\r\n    stripe_configured: !!stripeKey,\r\n    endpoint: '/api/webhooks/stripe',\r\n    test_endpoint: '/api/tests/stripe-webhook',\r\n    support_currencies: ['GEL', 'USD'],\r\n    timestamp: new Date().toISOString(),\r\n  });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\admin\\OneDrive\\Desktop\\avatar-g-frontend-v3\\app\\dashboard\\marketplace\\growth\\GrowthKPIsClient.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchKpis'. Either include it or remove the dependency array.","line":32,"column":6,"nodeType":"ArrayExpression","endLine":32,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [fetchKpis, storeId]","fix":{"range":[775,784],"text":"[fetchKpis, storeId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Marketplace Growth KPIs Dashboard - Client Component\r\n */\r\n'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\n\r\ninterface KPI {\r\n  id: string;\r\n  date: string;\r\n  impressions: number;\r\n  clicks: number;\r\n  conversions: number;\r\n  revenue_cents: number;\r\n}\r\n\r\ninterface Aggregates {\r\n  totalImpressions: number;\r\n  totalClicks: number;\r\n  totalConversions: number;\r\n  totalRevenueCents: number;\r\n}\r\n\r\nexport default function GrowthKPIsClient({ storeId }: { storeId: string }) {\r\n  const [kpis, setKpis] = useState<KPI[]>([]);\r\n  const [aggregates, setAggregates] = useState<Aggregates | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    fetchKpis();\r\n  }, [storeId]);\r\n\r\n  const fetchKpis = async () => {\r\n    try {\r\n      const response = await fetch(`/api/marketplace/kpis?storeId=${storeId}`);\r\n      if (!response.ok) throw new Error('Failed to fetch KPIs');\r\n      const data = await response.json();\r\n      setKpis(data.data.kpis);\r\n      setAggregates(data.data.aggregates);\r\n    } catch (err: unknown) {\r\n      setError(err.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const formatCents = (cents: number) => {\r\n    return `â‚¾${(cents / 100).toFixed(2)}`;\r\n  };\r\n\r\n  const ctr = aggregates && aggregates.totalImpressions > 0\r\n    ? ((aggregates.totalClicks / aggregates.totalImpressions) * 100).toFixed(2)\r\n    : 0;\r\n\r\n  const conversionRate = aggregates && aggregates.totalClicks > 0\r\n    ? ((aggregates.totalConversions / aggregates.totalClicks) * 100).toFixed(2)\r\n    : 0;\r\n\r\n  return (\r\n    <div className=\"space-y-8\">\r\n      {loading ? (\r\n        <p className=\"text-gray-400\">Loading KPIs...</p>\r\n      ) : error ? (\r\n        <div className=\"bg-red-900 border border-red-700 rounded p-3 text-red-100\">{error}</div>\r\n      ) : !aggregates ? (\r\n        <p className=\"text-gray-400\">No KPI data yet</p>\r\n      ) : (\r\n        <>\r\n          {/* KPI Cards */}\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div className=\"bg-gray-800 rounded-lg p-6\">\r\n              <div className=\"text-sm text-gray-400 mb-1\">Total Impressions</div>\r\n              <div className=\"text-3xl font-bold\">{aggregates.totalImpressions.toLocaleString()}</div>\r\n            </div>\r\n            <div className=\"bg-gray-800 rounded-lg p-6\">\r\n              <div className=\"text-sm text-gray-400 mb-1\">Total Clicks</div>\r\n              <div className=\"text-3xl font-bold\">{aggregates.totalClicks.toLocaleString()}</div>\r\n            </div>\r\n            <div className=\"bg-gray-800 rounded-lg p-6\">\r\n              <div className=\"text-sm text-gray-400 mb-1\">Total Conversions</div>\r\n              <div className=\"text-3xl font-bold\">{aggregates.totalConversions.toLocaleString()}</div>\r\n            </div>\r\n            <div className=\"bg-gray-800 rounded-lg p-6\">\r\n              <div className=\"text-sm text-gray-400 mb-1\">Total Revenue</div>\r\n              <div className=\"text-3xl font-bold\">{formatCents(aggregates.totalRevenueCents)}</div>\r\n            </div>\r\n            <div className=\"bg-gray-800 rounded-lg p-6\">\r\n              <div className=\"text-sm text-gray-400 mb-1\">CTR (Click-Through Rate)</div>\r\n              <div className=\"text-3xl font-bold\">{ctr}%</div>\r\n            </div>\r\n            <div className=\"bg-gray-800 rounded-lg p-6\">\r\n              <div className=\"text-sm text-gray-400 mb-1\">Conversion Rate</div>\r\n              <div className=\"text-3xl font-bold\">{conversionRate}%</div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Daily KPI History */}\r\n          <div className=\"bg-gray-800 rounded-lg p-6\">\r\n            <h3 className=\"text-xl font-bold mb-4\">Daily Performance (Last 30 Days)</h3>\r\n            {kpis.length === 0 ? (\r\n              <p className=\"text-gray-400\">No daily data yet</p>\r\n            ) : (\r\n              <div className=\"overflow-x-auto\">\r\n                <table className=\"w-full text-sm\">\r\n                  <thead className=\"border-b border-gray-700\">\r\n                    <tr>\r\n                      <th className=\"text-left py-2 px-2\">Date</th>\r\n                      <th className=\"text-right py-2 px-2\">Impressions</th>\r\n                      <th className=\"text-right py-2 px-2\">Clicks</th>\r\n                      <th className=\"text-right py-2 px-2\">Conversions</th>\r\n                      <th className=\"text-right py-2 px-2\">Revenue</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {kpis.map((kpi) => (\r\n                      <tr key={kpi.id} className=\"border-b border-gray-700 hover:bg-gray-700\">\r\n                        <td className=\"py-2 px-2\">{new Date(kpi.date).toLocaleDateString()}</td>\r\n                        <td className=\"text-right py-2 px-2\">{kpi.impressions.toLocaleString()}</td>\r\n                        <td className=\"text-right py-2 px-2\">{kpi.clicks.toLocaleString()}</td>\r\n                        <td className=\"text-right py-2 px-2\">{kpi.conversions.toLocaleString()}</td>\r\n                        <td className=\"text-right py-2 px-2\">{formatCents(kpi.revenue_cents)}</td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\admin\\OneDrive\\Desktop\\avatar-g-frontend-v3\\app\\seller\\activation\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'activateShop'. Either include it or remove the dependency array.","line":22,"column":6,"nodeType":"ArrayExpression","endLine":22,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [activateShop]","fix":{"range":[872,874],"text":"[activateShop]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Check, Loader2, Store, Shield, TrendingUp, CreditCard } from \"lucide-react\";\r\n\r\nexport default function SellerActivationPage() {\r\n  const router = useRouter();\r\n  const [activating, setActivating] = useState(true);\r\n  const [progress, setProgress] = useState(0);\r\n  const [steps, setSteps] = useState([\r\n    { id: 1, label: \"áƒ›áƒáƒ¦áƒáƒ–áƒ˜áƒ˜áƒ¡ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ\", status: \"pending\" },\r\n    { id: 2, label: \"Stripe Live áƒ˜áƒœáƒ¢áƒ”áƒ’áƒ áƒáƒªáƒ˜áƒ\", status: \"pending\" },\r\n    { id: 3, label: \"20% margin guard áƒ©áƒáƒ áƒ—áƒ•áƒ\", status: \"pending\" },\r\n    { id: 4, label: \"áƒ“áƒ¦áƒ’ áƒ›áƒáƒ“áƒ£áƒšáƒ˜áƒ¡ áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒáƒªáƒ˜áƒ\", status: \"pending\" },\r\n    { id: 5, label: \"áƒžáƒ˜áƒ áƒ•áƒ”áƒšáƒ˜ áƒžáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ˜áƒ¡ áƒ áƒ”áƒ™áƒáƒ›áƒ”áƒœáƒ“áƒáƒªáƒ˜áƒ\", status: \"pending\" },\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    activateShop();\r\n  }, []);\r\n\r\n  const activateShop = async () => {\r\n    // Load onboarding data\r\n    const stored = sessionStorage.getItem(\"seller_onboarding\");\r\n    if (!stored) {\r\n      router.push(\"/seller/onboarding\");\r\n      return;\r\n    }\r\n\r\n    const _onboardingData = JSON.parse(stored);\r\n\r\n    // Simulate activation steps\r\n    for (let i = 0; i < steps.length; i++) {\r\n      await new Promise((resolve) => setTimeout(resolve, 1500));\r\n      \r\n      setSteps((prev) =>\r\n        prev.map((step, idx) => ({\r\n          ...step,\r\n          status: idx <= i ? \"completed\" : \"pending\",\r\n        }))\r\n      );\r\n      \r\n      setProgress(((i + 1) / steps.length) * 100);\r\n    }\r\n\r\n    // Activation complete\r\n    await new Promise((resolve) => setTimeout(resolve, 500));\r\n    setActivating(false);\r\n\r\n    // In production: Call API to create seller profile\r\n    // POST /api/seller/activate with onboardingData\r\n\r\n    // Clear sessionStorage\r\n    sessionStorage.removeItem(\"seller_onboarding\");\r\n  };\r\n\r\n  const t = {\r\n    title: \"áƒ›áƒáƒ¦áƒáƒ–áƒ˜áƒ˜áƒ¡ áƒáƒ¥áƒ¢áƒ˜áƒ•áƒáƒªáƒ˜áƒ\",\r\n    subtitle: \"áƒ¨áƒ”áƒœáƒ˜ áƒ›áƒáƒ¦áƒáƒ–áƒ˜áƒ áƒ›áƒ–áƒáƒ“áƒ“áƒ”áƒ‘áƒ...\",\r\n    complete_title: \"âœ“ áƒ›áƒáƒ¦áƒáƒ–áƒ˜áƒ áƒ¡áƒáƒ™áƒ›áƒáƒáƒ“ áƒ›áƒ–áƒáƒ“áƒáƒ!\",\r\n    complete_subtitle: \"áƒ§áƒ•áƒ”áƒšáƒáƒ¤áƒ”áƒ áƒ˜ áƒ™áƒáƒœáƒ¤áƒ˜áƒ’áƒ£áƒ áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ. áƒáƒ®áƒšáƒ áƒ¨áƒ”áƒ’áƒ˜áƒ«áƒšáƒ˜áƒ áƒžáƒ˜áƒ áƒ•áƒ”áƒšáƒ˜ áƒžáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ˜áƒ¡ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ.\",\r\n    goto_dashboard: \"áƒ›áƒ—áƒáƒ•áƒáƒ  áƒžáƒáƒœáƒ”áƒšáƒ–áƒ” áƒ’áƒáƒ“áƒáƒ¡áƒ•áƒšáƒ\",\r\n    status_pending: \"áƒ›áƒáƒ›áƒšáƒáƒ“áƒ˜áƒœáƒ”\",\r\n    status_completed: \"áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜\",\r\n    activation_processing: \"áƒ›áƒáƒ¦áƒáƒ–áƒ˜áƒ˜áƒ¡ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ...\",\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-b from-[#05070A] via-[#0A0E1A] to-[#05070A] flex items-center justify-center px-4 py-12\">\r\n      <div className=\"max-w-2xl w-full\">\r\n        \r\n        {/* Header */}\r\n        <div className=\"text-center space-y-3 mb-10\">\r\n          <h1 className=\"text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent\">\r\n            {activating ? t.title : t.complete_title}\r\n          </h1>\r\n          <p className=\"text-gray-400\">\r\n            {activating ? t.subtitle : t.complete_subtitle}\r\n          </p>\r\n        </div>\r\n\r\n        {/* Progress Bar */}\r\n        {activating && (\r\n          <div className=\"mb-8\">\r\n            <div className=\"w-full bg-gray-800 rounded-full h-3 overflow-hidden\">\r\n              <div\r\n                className=\"bg-gradient-to-r from-blue-600 to-purple-600 h-full transition-all duration-500 ease-out\"\r\n                style={{ width: `${progress}%` }}\r\n              ></div>\r\n            </div>\r\n            <p className=\"text-center text-sm text-gray-500 mt-2\">\r\n              {Math.round(progress)}%\r\n            </p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Activation Steps */}\r\n        <div className=\"bg-gradient-to-br from-gray-900 to-gray-800/50 border border-gray-700/50 rounded-2xl p-8 space-y-6 mb-8\">\r\n          {steps.map((step) => (\r\n            <div key={step.id} className=\"flex items-center gap-4\">\r\n              <div className={`w-12 h-12 rounded-full flex items-center justify-center border-2 transition-all ${\r\n                step.status === \"completed\"\r\n                  ? \"bg-green-500/20 border-green-500\"\r\n                  : \"bg-gray-800/50 border-gray-700\"\r\n              }`}>\r\n                {step.status === \"completed\" ? (\r\n                  <Check className=\"w-6 h-6 text-green-500\" />\r\n                ) : (\r\n                  <Loader2 className=\"w-6 h-6 text-gray-500 animate-spin\" />\r\n                )}\r\n              </div>\r\n              <div className=\"flex-1\">\r\n                <p className={`font-semibold ${\r\n                  step.status === \"completed\" ? \"text-white\" : \"text-gray-400\"\r\n                }`}>\r\n                  {step.label}\r\n                </p>\r\n                <p className=\"text-sm text-gray-500\">\r\n                  {step.status === \"completed\" ? t.status_completed : t.status_pending}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Success State */}\r\n        {!activating && (\r\n          <div className=\"space-y-6\">\r\n            \r\n            {/* Feature Icons */}\r\n            <div className=\"grid grid-cols-4 gap-4\">\r\n              <div className=\"flex flex-col items-center gap-2 text-center\">\r\n                <div className=\"w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center\">\r\n                  <Store className=\"w-7 h-7 text-white\" />\r\n                </div>\r\n                <p className=\"text-xs text-gray-400\">áƒ›áƒáƒ¦áƒáƒ–áƒ˜áƒ</p>\r\n              </div>\r\n              <div className=\"flex flex-col items-center gap-2 text-center\">\r\n                <div className=\"w-14 h-14 bg-gradient-to-br from-green-600 to-emerald-600 rounded-xl flex items-center justify-center\">\r\n                  <Shield className=\"w-7 h-7 text-white\" />\r\n                </div>\r\n                <p className=\"text-xs text-gray-400\">20% Guard</p>\r\n              </div>\r\n              <div className=\"flex flex-col items-center gap-2 text-center\">\r\n                <div className=\"w-14 h-14 bg-gradient-to-br from-purple-600 to-pink-600 rounded-xl flex items-center justify-center\">\r\n                  <TrendingUp className=\"w-7 h-7 text-white\" />\r\n                </div>\r\n                <p className=\"text-xs text-gray-400\">AI áƒ áƒ”áƒ™áƒáƒ›áƒ”áƒœáƒ“áƒáƒªáƒ˜áƒ</p>\r\n              </div>\r\n              <div className=\"flex flex-col items-center gap-2 text-center\">\r\n                <div className=\"w-14 h-14 bg-gradient-to-br from-yellow-600 to-orange-600 rounded-xl flex items-center justify-center\">\r\n                  <CreditCard className=\"w-7 h-7 text-white\" />\r\n                </div>\r\n                <p className=\"text-xs text-gray-400\">Stripe Live</p>\r\n              </div>\r\n            </div>\r\n\r\n            {/* CTA Button */}\r\n            <Button\r\n              onClick={() => router.push(\"/dashboard/seller\")}\r\n              className=\"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white py-6 text-lg font-semibold rounded-xl shadow-2xl hover:shadow-green-500/50 transition-all duration-300\"\r\n            >\r\n              {t.goto_dashboard}\r\n            </Button>\r\n          </div>\r\n        )}\r\n\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\admin\\OneDrive\\Desktop\\avatar-g-frontend-v3\\components\\LanguageSwitcher.tsx","messages":[{"ruleId":null,"fatal":true,"severity":2,"message":"Parsing error: Declaration or statement expected.","line":92,"column":16,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useTransition } from 'react';\r\nimport { useLocale } from 'next-intl';\r\nimport { useRouter, usePathname } from 'next/navigation';\r\nimport { Globe, Check } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useState } from 'react';\r\n\r\nconst languages = [\r\n  { code: 'ka', label: 'áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜', flag: 'ðŸ‡¬ðŸ‡ª' },\r\n  { code: 'en', label: 'English', flag: 'ðŸ‡¬ðŸ‡§' },\r\n  { code: 'ru', label: 'Ð ÑƒÑÑÐºÐ¸Ð¹', flag: 'ðŸ‡·ðŸ‡º' },\r\n];\r\n\r\nexport default function LanguageSwitcher() {\r\n  const locale = useLocale();\r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [isPending, startTransition] = useTransition();\r\n\r\n  const currentLang = languages.find(l => l.code === locale) || languages[0];\r\n\r\n  const handleSelect = (newLocale: string) => {\r\n    startTransition(() => {\r\n      // Remove current locale from pathname\r\n      const pathWithoutLocale = pathname.slice(3); // Remove /ka, /en, /ru prefix\r\n      const newPathname = `/${newLocale}${pathWithoutLocale || ''}`;\r\n      router.push(newPathname);\r\n      setIsOpen(false);\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative\">\r\n      <motion.button\r\n        whileHover={{ scale: 1.05 }}\r\n        whileTap={{ scale: 0.95 }}\r\n        onClick={() => setIsOpen(!isOpen)}\r\n        className=\"flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 transition-colors disabled:opacity-50\"\r\n        disabled={isPending}\r\n      >\r\n        <Globe className=\"w-4 h-4 text-cyan-400\" />\r\n        <span className=\"text-sm text-gray-300\">{currentLang?.flag}</span>\r\n      </motion.button>\r\n\r\n      <AnimatePresence>\r\n        {isOpen && (\r\n          <>\r\n            <motion.div\r\n              initial={{ opacity: 0 }}\r\n              animate={{ opacity: 1 }}\r\n              exit={{ opacity: 0 }}\r\n              onClick={() => setIsOpen(false)}\r\n              className=\"fixed inset-0 z-40\"\r\n            />\r\n            <motion.div\r\n              initial={{ opacity: 0, y: 10, scale: 0.95 }}\r\n              animate={{ opacity: 1, y: 0, scale: 1 }}\r\n\r\n              exit={{ opacity: 0, y: 10, scale: 0.95 }}\r\n              className=\"absolute right-0 mt-2 w-48 py-2 rounded-xl bg-black/90 backdrop-blur-xl border border-cyan-500/20 shadow-xl z-50\"\r\n            >\r\n              {languages.map((lang) => (\r\n                <motion.button\r\n                  key={lang.code}\r\n                  whileHover={{ x: 4 }}\r\n                  onClick={() => handleSelect(lang.code)}\r\n                  className={`w-full flex items-center justify-between px-4 py-2.5 text-left transition-colors ${\r\n                    locale === lang.code\r\n                      ? 'bg-cyan-500/20 text-cyan-400'\r\n                      : 'text-gray-300 hover:bg-white/5 hover:text-white'\r\n                  }`}\r\n                  disabled={isPending}\r\n                >\r\n                  <span className=\"flex items-center gap-3\">\r\n                    <span>{lang.flag}</span>\r\n                    <span className=\"text-sm\">{lang.label}</span>\r\n                  </span>\r\n                  {locale === lang.code && <Check className=\"w-4 h-4\" />}\r\n                </motion.button>\r\n              ))}\r\n            </motion.div>\r\n          </>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}\r\n                  {locale === lang.code && <Check className=\"w-4 h-4\" />}\r\n                </motion.button>\r\n              ))}\r\n            </motion.div>\r\n          </>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\admin\\OneDrive\\Desktop\\avatar-g-frontend-v3\\components\\ui\\textarea.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":5,"column":18,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":5,"endColumn":31,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[77,164],"text":"type TextareaProps = React.TextareaHTMLAttributes<HTMLTextAreaElement>"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nexport interface TextareaProps\r\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\r\n\r\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\r\n  ({ className, ...props }, ref) => {\r\n    return (\r\n      <textarea\r\n        className={cn(\r\n          \"flex min-h-[80px] w-full rounded-md border border-white/10 bg-[#0A0F1C] px-3 py-2 text-sm text-white placeholder:text-gray-400 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cyan-500 focus-visible:ring-offset-2 focus-visible:ring-offset-[#05070A] disabled:cursor-not-allowed disabled:opacity-50\",\r\n          className\r\n        )}\r\n        ref={ref}\r\n        {...props}\r\n      />\r\n    )\r\n  }\r\n)\r\nTextarea.displayName = \"Textarea\"\r\n\r\nexport { Textarea }\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\admin\\OneDrive\\Desktop\\avatar-g-frontend-v3\\lib\\fulfillment\\TrackingSyncService.ts","messages":[{"ruleId":null,"fatal":true,"severity":2,"message":"Parsing error: '{' expected.","line":10,"column":26,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Tracking Sync Service\r\n// Periodically syncs tracking info from suppliers\r\n\r\nimport { SupabaseClient } from '@supabase/supabase-js';\r\nimport { SupplierAdapter } from '../suppliers/SupplierAdapter';\r\nimport { MockApiSupplierAdapter } from '../suppliers/MockApiSupplierAdapter';\r\nimport { ManualSupplierAdapter } from '../suppliers/ManualSupplierAdapter';\r\nimport { WarehouseAdapter } from '../suppliers/WarehouseAdapter';\r\n\r\nexport class TrackingSync Service {\r\n  private supabase: SupabaseClient;\r\n  private adapters: Map<string, SupplierAdapter>;\r\n\r\n  constructor(supabase: SupabaseClient) {\r\n    this.supabase = supabase;\r\n    this.adapters = new Map();\r\n  }\r\n\r\n  /**\r\n   * Sync tracking for all shipped orders\r\n   * Run this as a cron job (e.g., every 6 hours)\r\n   */\r\n  async syncAllTracking(): Promise<{ synced: number; errors: number }> {\r\n    let synced = 0;\r\n    let errors = 0;\r\n\r\n    try {\r\n      // Get all jobs with status 'shipped' that have supplier_order_id\r\n      const { data: jobs } = await this.supabase\r\n        .from('fulfillment_jobs')\r\n        .select('*, suppliers(*)')\r\n        .eq('status', 'shipped')\r\n        .not('supplier_order_id', 'is', null);\r\n\r\n      if (!jobs || jobs.length === 0) {\r\n        console.log('No jobs to sync');\r\n        return { synced, errors };\r\n      }\r\n\r\n      console.log(`Syncing tracking for ${jobs.length} jobs`);\r\n\r\n      for (const job of jobs) {\r\n        try {\r\n          const updated = await this.syncJobTracking(job);\r\n          if (updated) synced++;\r\n        } catch (error) {\r\n          console.error(`Error syncing job ${job.id}:`, error);\r\n          errors++;\r\n        }\r\n      }\r\n\r\n      return { synced, errors };\r\n    } catch (error) {\r\n      console.error('Error in syncAllTracking:', error);\r\n      return { synced, errors };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sync tracking for a specific job\r\n   */\r\n  async syncJobTracking(job: any): Promise<boolean> {\r\n    if (!job.supplier_id || !job.supplier_order_id) {\r\n      return false;\r\n    }\r\n\r\n    const adapter = await this.getSupplierAdapter(job. supplier_id, job.suppliers);\r\n    if (!adapter || !adapter.supportsFeature('auto_tracking')) {\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const tracking = await adapter.getTracking(job.supplier_order_id);\r\n      if (!tracking) return false;\r\n\r\n      // Update job if tracking number changed\r\n      if (tracking.trackingNumber && tracking.trackingNumber !== job.tracking_number) {\r\n        await this.supabase\r\n          .from('fulfillment_jobs')\r\n          .update({\r\n            tracking_number: tracking.trackingNumber,\r\n            carrier: tracking.carrier,\r\n          })\r\n          .eq('id', job.id);\r\n      }\r\n\r\n      // Update shipment record\r\n      if (tracking.trackingNumber) {\r\n        await this.updateShipmentTracking(job.order_id, tracking);\r\n      }\r\n\r\n      // Check if delivered\r\n      if (tracking.status === 'delivered') {\r\n        await this.handleDelivery(job);\r\n      }\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error(`Error syncing tracking for job ${job.id}:`, error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update shipment record with tracking events\r\n   */\r\n  private async updateShipmentTracking(orderId: string, tracking: any): Promise<void> {\r\n    const { data: shipment } = await this.supabase\r\n      .from('order_shipments')\r\n      .select('*')\r\n      .eq('order_id', orderId)\r\n      .eq('tracking_number', tracking.trackingNumber)\r\n      .single();\r\n\r\n    if (!shipment) {\r\n      // Create shipment if doesn't exist\r\n      await this.supabase.from('order_shipments').insert({\r\n        order_id: orderId,\r\n        tracking_number: tracking.trackingNumber,\r\n        carrier: tracking.carrier,\r\n        status: tracking.status,\r\n        tracking_events: tracking.events,\r\n      });\r\n    } else {\r\n      // Update existing shipment\r\n      await this.supabase\r\n        .from('order_shipments')\r\n        .update({\r\n          status: tracking.status,\r\n          tracking_events: tracking.events,\r\n          delivered_at:\r\n            tracking.status === 'delivered' && !shipment.delivered_at\r\n              ? new Date().toISOString()\r\n              : shipment.delivered_at,\r\n        })\r\n        .eq('id', shipment.id);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle delivery (mark order as delivered)\r\n   */\r\n  private async handleDelivery(job: any): Promise<void> {\r\n    // Update job status\r\n    await this.supabase\r\n      .from('fulfillment_jobs')\r\n      .update({ status: 'delivered' })\r\n      .eq('id', job.id);\r\n\r\n    // Check if all jobs for order are delivered\r\n    const { data: allJobs } = await this.supabase\r\n      .from('fulfillment_jobs')\r\n      .select('status')\r\n      .eq('order_id', job.order_id);\r\n\r\n    const allDelivered = allJobs?.every((j) => j.status === 'delivered');\r\n\r\n    if (allDelivered) {\r\n      // Mark order as delivered\r\n      await this.supabase\r\n        .from('orders')\r\n        .update({\r\n          status: 'delivered',\r\n          delivered_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', job.order_id);\r\n\r\n      // TODO: Send delivery confirmation email to customer\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get supplier adapter instance\r\n   */\r\n  private async getSupplierAdapter(\r\n    supplierId: string,\r\n    supplierData?: any\r\n  ): Promise<SupplierAdapter | null> {\r\n    if (this.adapters.has(supplierId)) {\r\n      return this.adapters.get(supplierId)!;\r\n    }\r\n\r\n    let supplier = supplierData;\r\n    if (!supplier) {\r\n      const { data } = await this.supabase\r\n        .from('suppliers')\r\n        .select('*')\r\n        .eq('id', supplierId)\r\n        .single();\r\n      supplier = data;\r\n    }\r\n\r\n    if (!supplier) return null;\r\n\r\n    let adapter: SupplierAdapter;\r\n\r\n    switch (supplier.type) {\r\n      case 'manual':\r\n        adapter = new ManualSupplierAdapter(supplier.id, supplier.name);\r\n        break;\r\n      case 'warehouse':\r\n        adapter = new WarehouseAdapter(supplier.id, supplier.name);\r\n        break;\r\n      case 'api':\r\n        adapter = new MockApiSupplierAdapter({\r\n          supplierId: supplier.id,\r\n          supplierName: supplier.name,\r\n          apiEndpoint: supplier.api_endpoint,\r\n          apiKey: supplier.api_key_encrypted,\r\n        });\r\n        break;\r\n      default:\r\n        return null;\r\n    }\r\n\r\n    this.adapters.set(supplierId, adapter);\r\n    return adapter;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\admin\\OneDrive\\Desktop\\avatar-g-frontend-v3\\lib\\invoice\\pdf.ts","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":296,"column":25,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":296,"endColumn":42}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { InvoiceSnapshot, formatPrice } from './generator';\r\n\r\n// ========================================\r\n// PDF INVOICE GENERATION\r\n// ========================================\r\n\r\n/**\r\n * Generate invoice HTML (can be converted to PDF server-side)\r\n * This is the core invoice layout - in production, use a proper PDF library\r\n */\r\nexport function generateInvoiceHtml(snapshot: InvoiceSnapshot): string {\r\n  const rowsHtml = snapshot.items\r\n    .map(\r\n      (item) => `\r\n    <tr>\r\n      <td style=\"padding: 10px; border-bottom: 1px solid #e0e0e0;\">${item.title}</td>\r\n      <td style=\"padding: 10px; border-bottom: 1px solid #e0e0e0; text-align: center;\">${item.quantity}</td>\r\n      <td style=\"padding: 10px; border-bottom: 1px solid #e0e0e0; text-align: right;\">${formatPrice(item.unitPriceCents, snapshot.currency)}</td>\r\n      <td style=\"padding: 10px; border-bottom: 1px solid #e0e0e0; text-align: right; font-weight: bold;\">${formatPrice(item.lineTotalCents, snapshot.currency)}</td>\r\n    </tr>\r\n  `\r\n    )\r\n    .join('');\r\n\r\n  const issueDate = new Date(snapshot.issuedAt);\r\n  const issueDateStr = issueDate.toLocaleDateString('ka-GE', {\r\n    year: 'numeric',\r\n    month: 'long',\r\n    day: 'numeric',\r\n  });\r\n\r\n  const vatLabel =\r\n    snapshot.taxStatus === 'vat_payer'\r\n      ? `áƒ“áƒ¦áƒ’ (${(snapshot.vatRateBps / 100).toFixed(1)}%)`\r\n      : 'áƒáƒ  áƒáƒ áƒ˜áƒ¡ áƒ“áƒ¦áƒ’ áƒ’áƒáƒ“áƒáƒ›áƒ®áƒ“áƒ”áƒšáƒ˜';\r\n\r\n  const html = `<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <title>áƒ˜áƒœáƒ•áƒáƒ˜áƒ¡áƒ˜ ${snapshot.invoiceNumber}</title>\r\n  <style>\r\n    body {\r\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\r\n      color: #333;\r\n      margin: 0;\r\n      padding: 20px;\r\n      background: #f5f5f5;\r\n    }\r\n    .invoice-container {\r\n      max-width: 800px;\r\n      margin: 0 auto;\r\n      background: white;\r\n      padding: 40px;\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.1);\r\n      border-radius: 4px;\r\n    }\r\n    .header {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      margin-bottom: 40px;\r\n      border-bottom: 2px solid #f0f0f0;\r\n      padding-bottom: 20px;\r\n    }\r\n    .company-info h1 {\r\n      margin: 0;\r\n      font-size: 24px;\r\n      color: #000;\r\n    }\r\n    .company-info p {\r\n      margin: 4px 0;\r\n      color: #666;\r\n      font-size: 14px;\r\n    }\r\n    .invoice-meta {\r\n      text-align: right;\r\n    }\r\n    .invoice-meta h2 {\r\n      margin: 0;\r\n      font-size: 36px;\r\n      color: #e74c3c;\r\n      font-weight: bold;\r\n    }\r\n    .invoice-meta p {\r\n      margin: 4px 0;\r\n      color: #666;\r\n      font-size: 14px;\r\n    }\r\n    .addresses {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      margin-bottom: 40px;\r\n    }\r\n    .address-section {\r\n      flex: 1;\r\n    }\r\n    .address-section h3 {\r\n      font-size: 12px;\r\n      color: #999;\r\n      margin: 0 0 8px 0;\r\n      text-transform: uppercase;\r\n      font-weight: 600;\r\n    }\r\n    .address-section p {\r\n      margin: 4px 0;\r\n      font-size: 14px;\r\n      line-height: 1.6;\r\n    }\r\n    table {\r\n      width: 100%;\r\n      border-collapse: collapse;\r\n      margin-bottom: 30px;\r\n    }\r\n    th {\r\n      background: #f9f9f9;\r\n      padding: 12px;\r\n      text-align: left;\r\n      font-weight: 600;\r\n      font-size: 13px;\r\n      color: #333;\r\n      border-bottom: 2px solid #e0e0e0;\r\n    }\r\n    .totals {\r\n      margin-bottom: 40px;\r\n    }\r\n    .total-row {\r\n      display: flex;\r\n      justify-content: flex-end;\r\n      margin-bottom: 12px;\r\n      font-size: 14px;\r\n    }\r\n    .total-row-label {\r\n      width: 200px;\r\n      text-align: right;\r\n      padding-right: 20px;\r\n      color: #666;\r\n    }\r\n    .total-row-value {\r\n      width: 120px;\r\n      text-align: right;\r\n      font-weight: 600;\r\n    }\r\n    .final-total {\r\n      display: flex;\r\n      justify-content: flex-end;\r\n      margin-top: 20px;\r\n      padding-top: 20px;\r\n      border-top: 2px solid #e0e0e0;\r\n      font-size: 18px;\r\n    }\r\n    .final-total .total-row-label {\r\n      color: #000;\r\n      font-weight: bold;\r\n    }\r\n    .final-total .total-row-value {\r\n      font-size: 20px;\r\n      color: #e74c3c;\r\n    }\r\n    .vat-status {\r\n      background: #f0f8ff;\r\n      border-left: 4px solid #2196F3;\r\n      padding: 12px;\r\n      margin: 20px 0;\r\n      font-size: 13px;\r\n      color: #1976D2;\r\n    }\r\n    .vat-status.non-vat {\r\n      background: #e8f5e9;\r\n      border-left-color: #4caf50;\r\n      color: #2e7d32;\r\n    }\r\n    .footer {\r\n      border-top: 1px solid #e0e0e0;\r\n      padding-top: 20px;\r\n      margin-top: 40px;\r\n      font-size: 12px;\r\n      color: #999;\r\n      text-align: center;\r\n    }\r\n  </style>\r\n</head>\r\n<body>\r\n  <div class=\"invoice-container\">\r\n    <!-- Header -->\r\n    <div class=\"header\">\r\n      <div class=\"company-info\">\r\n        <!-- Avatar G Logo -->\r\n        <div style=\"display: flex; align-items: center; gap: 12px; margin-bottom: 16px;\">\r\n          <div style=\"width: 48px; height: 48px; background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);\">\r\n            <svg width=\"28\" height=\"28\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n              <path d=\"M4.5 16.5c-1.5 1.25-2 5-2 5s3.75-.5 5-2c.625-.625 1-1.5 1-2.5v-2.5l-4 4z\"></path>\r\n              <path d=\"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z\"></path>\r\n              <path d=\"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0\"></path>\r\n              <path d=\"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5\"></path>\r\n            </svg>\r\n          </div>\r\n          <div>\r\n            <h1 style=\"font-size: 24px; margin: 0; font-weight: 700;\">Avatar G</h1>\r\n            <p style=\"margin: 0; font-size: 12px; color: #666;\">AI áƒ™áƒáƒ›áƒ”áƒ áƒªáƒ˜áƒ˜áƒ¡ áƒžáƒšáƒáƒ¢áƒ¤áƒáƒ áƒ›áƒ</p>\r\n          </div>\r\n        </div>\r\n        <h2 style=\"font-size: 18px; margin: 0 0 8px 0; font-weight: 600;\">${snapshot.storeName}</h2>\r\n        <p>${snapshot.storeEmail}</p>\r\n        ${snapshot.storeAddress ? `<p>${snapshot.storeAddress}</p>` : ''}\r\n        ${snapshot.storeVatRegNo ? `<p><strong>áƒ“áƒ¦áƒ’ áƒ áƒ”áƒ’. â„–:</strong> ${snapshot.storeVatRegNo}</p>` : ''}\r\n      </div>\r\n      <div class=\"invoice-meta\">\r\n        <h2>#${snapshot.invoiceNumber}</h2>\r\n        <p><strong>áƒ˜áƒœáƒ•áƒáƒ˜áƒ¡áƒ˜áƒ¡ áƒ—áƒáƒ áƒ˜áƒ¦áƒ˜:</strong> ${issueDateStr}</p>\r\n        <p><strong>áƒ¨áƒ”áƒ™áƒ•áƒ”áƒ—áƒ˜áƒ¡ ID:</strong> ${snapshot.orderId.substring(0, 8)}</p>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Addresses -->\r\n    <div class=\"addresses\">\r\n      <div class=\"address-section\">\r\n        <h3>áƒ›áƒ˜áƒ›áƒ¦áƒ”áƒ‘áƒ˜</h3>\r\n        <p><strong>${snapshot.buyerName}</strong></p>\r\n        <p>${snapshot.buyerEmail}</p>\r\n      </div>\r\n      <div class=\"address-section\">\r\n        <h3>áƒ’áƒáƒ›áƒáƒ›áƒ’áƒ–áƒáƒ•áƒœáƒ˜</h3>\r\n        <p><strong>${snapshot.storeName}</strong></p>\r\n        <p>${snapshot.storeEmail}</p>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Items Table -->\r\n    <table>\r\n      <thead>\r\n        <tr>\r\n          <th>áƒáƒ¦áƒ¬áƒ”áƒ áƒ</th>\r\n          <th style=\"text-align: center; width: 80px;\">áƒ áƒáƒáƒ“áƒ”áƒœáƒáƒ‘áƒ</th>\r\n          <th style=\"text-align: right; width: 100px;\">áƒ”áƒ áƒ—áƒ”áƒ£áƒšáƒ˜áƒ¡ áƒ¤áƒáƒ¡áƒ˜</th>\r\n          <th style=\"text-align: right; width: 100px;\">áƒ—áƒáƒœáƒ®áƒ</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        ${rowsHtml}\r\n      </tbody>\r\n    </table>\r\n\r\n    <!-- Totals -->\r\n    <div class=\"totals\">\r\n      <div class=\"total-row\">\r\n        <div class=\"total-row-label\">áƒ¨áƒ£áƒáƒšáƒ”áƒ“áƒ£áƒ áƒ˜ áƒ¯áƒáƒ›áƒ˜</div>\r\n        <div class=\"total-row-value\">${formatPrice(snapshot.subtotalCents, snapshot.currency)}</div>\r\n      </div>\r\n      <div class=\"total-row\">\r\n        <div class=\"total-row-label\">${vatLabel}</div>\r\n        <div class=\"total-row-value\">${formatPrice(snapshot.vatAmountCents, snapshot.currency)}</div>\r\n      </div>\r\n      <div class=\"final-total\">\r\n        <div class=\"total-row-label\">áƒ¡áƒ£áƒš</div>\r\n        <div class=\"total-row-value\">${formatPrice(snapshot.totalCents, snapshot.currency)}</div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Tax Status -->\r\n    <div class=\"vat-status ${snapshot.taxStatus === 'non_vat_payer' ? 'non-vat' : ''}\">\r\n      <strong>áƒ¡áƒáƒ’áƒáƒ“áƒáƒ¡áƒáƒ®áƒáƒ“áƒ áƒ¡áƒ¢áƒáƒ¢áƒ£áƒ¡áƒ˜:</strong>\r\n      ${snapshot.taxStatus === 'vat_payer'\r\n        ? `áƒ“áƒ¦áƒ’ áƒ’áƒáƒ“áƒáƒ›áƒ®áƒ“áƒ”áƒšáƒ˜ - áƒ“áƒ¦áƒ’ áƒ¨áƒ”áƒ“áƒ˜áƒ¡ áƒ¯áƒáƒ›áƒ¨áƒ˜ (${(snapshot.vatRateBps / 100).toFixed(1)}%)`\r\n        : 'áƒáƒ  áƒáƒ áƒ˜áƒ¡ áƒ“áƒ¦áƒ’ áƒ’áƒáƒ“áƒáƒ›áƒ®áƒ“áƒ”áƒšáƒ˜ - áƒ“áƒ¦áƒ’ áƒáƒ  áƒáƒ áƒ˜áƒ¡ áƒ’áƒáƒ—áƒ•áƒáƒšáƒ˜áƒ¡áƒ¬áƒ˜áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜'}\r\n    </div>\r\n\r\n    <!-- Footer -->\r\n    <div class=\"footer\">\r\n      <p>áƒ”áƒ¡ áƒ˜áƒœáƒ•áƒáƒ˜áƒ¡áƒ˜ áƒ’áƒ”áƒœáƒ”áƒ áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ áƒáƒ•áƒ¢áƒáƒ›áƒáƒ¢áƒ£áƒ áƒáƒ“. áƒ®áƒ”áƒšáƒ›áƒáƒ¬áƒ”áƒ áƒ áƒáƒ  áƒáƒ áƒ˜áƒ¡ áƒ¡áƒáƒ­áƒ˜áƒ áƒ.</p>\r\n      <p>áƒ’áƒ”áƒœáƒ”áƒ áƒáƒªáƒ˜áƒ˜áƒ¡ áƒ—áƒáƒ áƒ˜áƒ¦áƒ˜: ${new Date().toLocaleDateString('ka-GE')} | Avatar G</p>\r\n    </div>\r\n  </div>\r\n</body>\r\n</html>`;\r\n\r\n  return html;\r\n}\r\n\r\n/**\r\n * Convert HTML to PDF (requires external service or library)\r\n * For production, use Puppeteer, wkhtmltopdf, or a service like Vercel /pdf-generator\r\n * For now, returning a placeholder that can be implemented\r\n */\r\nexport async function convertHtmlToPdf(html: string): Promise<Buffer> {\r\n  // In production, use one of:\r\n  // 1. Puppeteer (requires Chrome/Chromium)\r\n  // 2. pdfkit (simple Node PDF generation)\r\n  // 3. External service (e.g., Vercel's /pdf-generator)\r\n  // 4. wkhtmltopdf (system binary)\r\n\r\n  // For development, we'll create a simple wrapper\r\n  // This is a placeholder - in production, implement one of the above\r\n\r\n  try {\r\n    // Try dynamic import of pdfkit if available\r\n    const PDFDocument = require('pdfkit');\r\n    const doc = new PDFDocument({\r\n      size: 'A4',\r\n      margin: 50,\r\n    });\r\n\r\n    const chunks: Buffer[] = [];\r\n    await new Promise<void>((resolve, reject) => {\r\n      doc.on('data', (chunk: Buffer) => chunks.push(chunk));\r\n      doc.on('end', () => resolve());\r\n      doc.on('error', reject);\r\n\r\n      // Write HTML-inspired content to PDF\r\n      doc.fontSize(20).text('áƒ˜áƒœáƒ•áƒáƒ˜áƒ¡áƒ˜ áƒ’áƒ”áƒœáƒ”áƒ áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ', { align: 'center' });\r\n      doc.moveDown();\r\n      doc.fontSize(10).text('HTML-áƒ“áƒáƒœ PDF-áƒ¨áƒ˜ áƒ™áƒáƒœáƒ•áƒ”áƒ áƒ¢áƒáƒªáƒ˜áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡ áƒ¡áƒáƒ­áƒ˜áƒ áƒáƒ PDF áƒ‘áƒ˜áƒ‘áƒšáƒ˜áƒáƒ—áƒ”áƒ™áƒ.');\r\n      doc.text(`HTML áƒ¡áƒ˜áƒ’áƒ áƒ«áƒ”: ${html.length} áƒ¡áƒ˜áƒ›áƒ‘áƒáƒšáƒ`);\r\n      doc.end();\r\n    });\r\n\r\n    return Buffer.concat(chunks);\r\n  } catch {\r\n    // Fallback: return HTML as string in buffer (for testing)\r\n    console.warn('PDF library not available, returning HTML buffer');\r\n    return Buffer.from(html, 'utf-8');\r\n  }\r\n}\r\n\r\n/**\r\n * Store PDF to Supabase Storage\r\n */\r\nexport async function storePdfToSupabase(\r\n  invoiceId: string,\r\n  pdfBuffer: Buffer,\r\n  supabaseClient: unknown\r\n): Promise<string | null> {\r\n  try {\r\n    const fileName = `invoice-${invoiceId}.pdf`;\r\n    const path = `invoices/${fileName}`;\r\n\r\n    const { error } = await supabaseClient.storage\r\n      .from('private-invoices')\r\n      .upload(path, pdfBuffer, {\r\n        contentType: 'application/pdf',\r\n        upsert: true,\r\n      });\r\n\r\n    if (error) {\r\n      console.error('Error storing PDF:', error);\r\n      return null;\r\n    }\r\n\r\n    return path;\r\n  } catch (error) {\r\n    console.error('Error storing PDF to Supabase:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Generate signed URL for PDF download\r\n */\r\nexport async function generateSignedPdfUrl(\r\n  pdfPath: string,\r\n  supabaseClient: unknown,\r\n  expiresInSeconds: number = 3600\r\n): Promise<string | null> {\r\n  try {\r\n    const { data, error } = await supabaseClient.storage\r\n      .from('private-invoices')\r\n      .createSignedUrl(pdfPath, expiresInSeconds);\r\n\r\n    if (error || !data?.signedUrl) {\r\n      console.error('Error generating signed URL:', error);\r\n      return null;\r\n    }\r\n\r\n    return data.signedUrl;\r\n  } catch (error) {\r\n    console.error('Error generating signed URL:', error);\r\n    return null;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]}]